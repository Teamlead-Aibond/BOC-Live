<!-- 
    /* ===================================================
* @copyright Copyright Â 2020 - 2023 Aibond Corp.
*
* All Rights Reserved.
*
* ========================================================== */
 -->
<div class="sideNavcontainer">
    <app-page-title title="Sales Quotes List" [breadcrumbItems]="breadCrumbItems"></app-page-title>

    <div class="row">
        <div class="col-xl-12">
            <div class="card-box">
                <div class="row">
                    <div class="col-xl-3 sales-left d-print-none">
                        <div class="row" style="color: red;">
                            {{ResponseMessage}}
                        </div>
                        <h2>
                            <div class="btn-group btn-group-sm all-togg mbg" style="padding-top:10px;">
                                <ng-template [ngTemplateOutlet]="SearchBar"></ng-template>&nbsp;

                            </div>
                            &nbsp;&nbsp;

                            <div class="btn-group btn-group-sm all-togg mbg" style="padding-top: 10px;">
                                <button style="padding:8px 12px 3px;" ngbTooltip="Print" onclick="javascript:window.print()" placement="top" class="btn btn-icon waves-effect" title="Print">
                                    <i style="font-size:16px;" class="fe-printer"></i></button>
                            </div>
                            &nbsp;&nbsp;

                            <!-- <div class="btn-group btn-group-sm all-togg mbg" style="padding-top: 10px;">
                                <button ngbTooltip="Excel" placement="top" class="btn btn-icon waves-effect" title="Excel" type="button" (click)="exportAsXLSX()">
                                    <i style="font-size:20px;" class="far fa-file-excel"></i></button>
                            </div> -->
                        </h2>

                        <div class="scrollbar">
                            <div class="table-responsive">
                                <table id="datatable-angular" datatable [dtOptions]="dtOptions" class="table table-hover mb-0">
                                    <thead>
                                        <tr>
                                            <!-- <th>#</th> -->
                                            <th>Sales Quotes List</th>
                                            <th>Quote No</th>
                                            <th>Customer Name</th>
                                            <th>Status</th>
                                            <th>Created</th>
                                            <th>Grand Total</th>
                                            <th>Customer Id</th>
                                            <th>RRNo</th>
                                            <th>Quote Type</th>
                                            <th>Description</th>
                                            <th>Quote Date</th>
                                            <th>Quote Date To</th>
                                        </tr>
                                    </thead>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-9 sales-right">
                        <ng-container [ngTemplateOutlet]="templateSettings"></ng-container>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<ng-template #SearchBar>
    <div class="btn-group dropdown" ngbDropdown>
        <a (click)="EnableSearch()" class="dropdown-toggle arrow-none btn btn-icon btn-sm" ngbDropdownToggle data-toggle="dropdown" aria-expanded="false"><i class="remixicon-search-line"></i> Search</a>
        <div class="dropdown-menu dropdown-menu-right mt-0" ngbDropdownMenu *ngIf="showSearch">

            <div class="row collapse show searchbox">
                <!-- Row 1-->

                <div class="col-12 col-xl-6">
                    <label class="control-label">Repair Request # </label>
                    <input type="text" class="form-control" placeholder="Enter Repair Request #" [(ngModel)]="RRNo">
                </div>


                <div class="col-12 col-xl-6">
                    <label class="control-label">Sales Quote #</label>
                    <input type="text" class="form-control" placeholder="Enter Sales Quote #" [(ngModel)]="QuoteNo">
                </div>

                <div class="col-12 col-xl-6 mt-15">
                    <label class="control-label">Customer</label>
                    <ng-select [items]="customerList" [searchable]="true" [(ngModel)]="CustomerId" placeholder="Select" bindLabel="title" bindValue="CustomerId">
                    </ng-select>
                </div>

                <div class="col-12 col-xl-6 mt-15">
                    <label class="control-label">Quotes Description</label>
                    <input type="text" class="form-control" [(ngModel)]="Description" placeholder="Enter Quote Description">
                </div>
                <div class="col-12 col-xl-6 mt-15">
                    <label class="control-label">Quotes Date From</label>
                    <div class="input-group clockpicker">
                        <input ngbDatepicker class="form-control" [(ngModel)]="QuoteDate" autoClose="false" placeholder="MM/DD/YYYY" #Quotes_Date_From="ngbDatepicker" (ngModelChange)="QuoteDateFormat(QuoteDate)">
                        <div class="input-group-append" (click)="Quotes_Date_From.toggle()">
                            <span class="input-group-text"><i class="mdi mdi-calendar"></i></span>
                        </div>
                    </div>
                </div>
                <div class="col-12 col-xl-6 mt-15">
                    <label class="control-label">Quotes Date To</label>
                    <div class="input-group clockpicker">
                        <input ngbDatepicker class="form-control" [(ngModel)]="QuoteDateTo" autoClose="false" placeholder="MM/DD/YYYY" #Quotes_Date_To="ngbDatepicker" (ngModelChange)="QuoteDateToFormat(QuoteDateTo)">
                        <div class="input-group-append" (click)="Quotes_Date_To.toggle()">
                            <span class="input-group-text"><i class="mdi mdi-calendar"></i></span>
                        </div>
                    </div>
                </div>


                <div class="col-12 col-xl-6 mt-15">
                    <label class="control-label">Quotes Type</label>
                    <select class="custom-select" [(ngModel)]="QuoteType">
                        <option value="undefined">Select</option>
                        <option *ngFor="let Type of QuoteTypeList" value="{{Type.Quote_TypeId}}">
                            {{Type.Quote_TypeName}}</option>

                    </select>

                </div>


                <div class="col-12 col-xl-6 mt-15">
                    <label class="control-label">Status</label>
                    <select class="custom-select" [(ngModel)]="Status">
                        <option value="undefined">Select all except Quoted</option>
                        <option *ngFor="let SQ_status of SalesQuoteStatusList"
                            value="{{SQ_status.SalesQuote_StatusId}}">
                            {{SQ_status.SalesQuote_StatusName}}</option>

                    </select>

                </div>
                <div class="col-12 col-xl-6 mt-15">
                    <input type="button" class="btn btn-primary btn-md mr-2" value="Search" (click)="onFilter($event)" />
                    <input type="button" class="btn btn-secondary btn-md mr-2" value="Clear" (click)="onClear($event)" />
                </div>
            </div>
        </div>
    </div>
</ng-template>


<ng-template #viewTemplate>
    <div class="row mb-10 d-print-none">
        <div class="col-xl-6 col-md-6">
            <h2>Sales Quote #{{number}}</h2>
        </div>
        <div class="col-xl-6 col-md-6">
            <div class="btn-group btn-group-sm float-right" role="group">

                <button ngbTooltip="Export to PDF" placement="top" value="Download" class="btn btn-icon waves-effect" (click)="generatePDF()" title="Export to PDF">
                    <i class="mdi mdi-file-pdf-outline"></i></button>
                <button ngbTooltip="Print" onclick="javascript:window.print()" placement="top" class="btn btn-icon waves-effect" title="Print">
                    <i class="fe-printer"></i></button>


            </div>
        </div>
    </div>

    <div class="row mt-20">
        <div class="col-12">
            <div class="card-box nopad">
                <div id="contentToConvert" [ngClass]="(hideAddress==false)?'col-12 pdfwrap black':'col-12 pdfwrap'">
                    <!-- Logo & title -->

                    <div class="row pdfex">
                        <div class="col-sm-6 col-xl-3">
                            <div class="clearfix ">
                                <div class="float-left ">
                                    <img src="assets/images/ah_logo.png " alt=" " height="35">
                                </div>
                            </div>
                            <div class="mt-3 ccs">
                                <p><b>Sales Quote #{{number}}</b>
                                </p>
                                <div class="button-list">
                                    <button type="button" class="btn btn-success waves-effect waves-light btntype">{{SalesQuoteInfo.QuoteTypeName}}</button>
                                </div>
                            </div>
                        </div>
                        <!-- end col -->
                        <div class="col-sm-6 col-xl-5">
                            <div class="mt-6 row ">

                                <div class="col-xl-5 col-md-5 ccs">
                                    <p class="m-b-10 text-right "><strong>Customer : </strong></p>
                                </div>
                                <div class="col-xl-7 col-md-7">
                                    <p class="m-b-10 "><span class="customerbg ">{{SalesQuoteInfo.CompanyName}}</span>
                                    </p>
                                </div>

                                <div class="col-xl-5 col-md-5 ccs">
                                    <p class="m-b-10 text-right "><strong>Current Status : </strong></p>
                                </div>
                                <div class="col-xl-7 col-md-7">
                                    <p class="m-b-10 "><span class="approvebg ">{{SalesQuoteInfo.StatusName}}</span></p>
                                </div>
                                <div class="col-xl-5 col-md-5">
                                    &nbsp;
                                </div>
                                <div class="col-xl-7 col-md-7" *ngIf="RRId !=0">
                                    <p class="m-b-10"><span class="Repair">{{repairMessage}}</span></p>

                                </div>
                            </div>
                        </div>

                        <!-- end col -->
                        <div class="col-sm-12 col-xl-4">
                            <div class="mt-3 float-right sales-table">
                                <div class="table-responsive">
                                    <table class="table table-borderless bill1 mb-0">
                                        <tbody>
                                            <tr>
                                                <th align="right" scope="row">
                                                    <p><b>Quote Date :</b></p>
                                                </th>
                                                <td>
                                                    <p>{{SalesQuoteInfo.QuoteDate}}</p>
                                                </td>
                                            </tr>
                                            <tr>
                                                <th align="right" scope="row">
                                                    <p><b>Sales Quote Type :</b></p>
                                                </th>
                                                <td>
                                                    <p>{{SalesQuoteInfo.QuoteTypeName}}</p>
                                                </td>
                                            </tr>
                                            <tr>
                                                <th align="right" scope="row">
                                                    <p><b>Terms :</b></p>
                                                </th>
                                                <td>
                                                    <p>{{SalesQuoteInfo.Terms}}</p>
                                                </td>
                                            </tr>
                                            <tr>
                                                <th align="right" scope="row">
                                                    <p><b>Tax Type :</b></p>
                                                </th>
                                                <td>
                                                    <p>{{SalesQuoteInfo.TaxTypeName}}</p>
                                                </td>
                                            </tr>

                                            <tr *ngIf="RRId !=0">
                                                <th scope="row">
                                                    <p><strong>Repair Request # : </strong></p>
                                                </th>
                                                <td>
                                                    <p><span><a (click)="backToRRView()"
                                                                routerLink="#">{{SalesQuoteInfo.RRNo}}</a></span>
                                                    </p>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <!-- end col -->
                    </div>
                    <!-- end row -->

                    <div class="row mt-4">
                        <div class="col-sm-6 col-xl-4">
                            <h5>Customer Address</h5>
                            <address *ngIf="CustomerAddress!='' ">

                                {{CustomerAddress.StreetAddress}} {{CustomerAddress.SuiteOrApt}},{{CustomerAddress.City}}<br>
                                {{CustomerAddress.StateName}}, {{CustomerAddress.CountryName}} - {{CustomerAddress.Zip}}
                                <div class="clear1">&nbsp;</div>
                                <span><i class="mdi mdi-phone mr-1 " ngbTooltip="Primary "
                                        *ngIf="PhoneCustomerAddress!=null"></i>
                                    {{CustomerAddress.Phone}}</span>
                                <div class="clear1">&nbsp;</div>
                                <span><i class="mdi mdi-fax mr-1 " *ngIf="faxCustomerAddress!='' "></i>
                                    {{CustomerAddress.Fax}}</span>
                            </address>
                        </div>

                        <div class="col-sm-6 col-xl-4 text-left">
                            <h5>Billing Address</h5>
                            <address *ngIf="BillingAddress!='' ">

                                {{BillingAddress.StreetAddress}}  {{BillingAddress.SuiteOrApt}}, {{BillingAddress.City}}<br>
                                {{BillingAddress.StateName}}, {{BillingAddress.CountryName}} - {{BillingAddress.Zip}}
                                <div class="clear1">&nbsp;</div>
                                <span><i class="mdi mdi-phone mr-1 " ngbTooltip="Primary "
                                        *ngIf="PhoneBillingAddress!=null "></i>
                                    {{BillingAddress.Phone}}</span>
                                <div class="clear1">&nbsp;</div>
                                <span><i class="mdi mdi-fax mr-1 " *ngIf="faxBillingAddress!='' "></i>
                                    {{BillingAddress.Fax}}</span>
                            </address>
                        </div>

                        <div class="col-sm-6 col-xl-4 float-right sales-table">
                            <h5>Shipping Address</h5>
                            <address *ngIf="ShippingAddress!='' ">
                                {{ShippingAddress.StreetAddress}} {{ShippingAddress.SuiteOrApt}},{{ShippingAddress.City}}<br>
                                {{ShippingAddress.StateName}}, {{ShippingAddress.CountryName}}  - {{ShippingAddress.Zip}}
                                <div class="clear1">&nbsp;</div>
                                <span><i class="mdi mdi-phone mr-1 " ngbTooltip="Primary "
                                        *ngIf="PhoneShippingAddress!=null "></i>
                                    {{ShippingAddress.Phone}}</span>
                                <div class="clear1">&nbsp;</div>
                                <span><i class="mdi mdi-fax mr-1 " *ngIf="faxShippingAddress!=''"></i>
                                    {{ShippingAddress.Fax}}</span>
                            </address>
                        </div>
                    </div>

                    <div class="row" *ngIf="RRId !=0">
                        <div class="col-12 ">
                            <h5>Root Cause</h5>
                            {{SalesQuoteInfo.RouteCause||'-'}}
                        </div>
                    </div>



                    <div class="row">
                        <div class="col-6 mb20">
                            <h5>Description</h5>
                            {{SalesQuoteInfo.Description||'-'}}
                        </div>
                        <div class="col-6 mb20 text-right">
                            <h5>Notes</h5>
                            {{SalesQuoteInfo.Notes||'-'}}
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12">
                            <h5>Customer Quote</h5>
                            <div class="table-responsive">
                                <table class="table mt-2 table-bordered mb-0 print-table">
                                    <thead class="thead-light">
                                        <tr>
                                            <th width="15%">Part #</th>
                                            <th width="31%">Part Description</th>
                                            <th width="10%">Lead Time</th>
                                            <th width="11%">Quantity</th>
                                            <th width="11%">Rate</th>
                                            <th width="11%">Price</th>
                                            <th width="16%">Warranty Period</th>
                                        </tr>
                                    </thead>
                                    <tbody *ngFor="let item of QuoteItem; let i=index">
                                        <tr>
                                            <td>{{item.PartNo}}
                                            </td>
                                            <td>{{item.PartDescription}}

                                            </td>
                                            <td>
                                                <p *ngIf="item.LeadTime !=''">{{item.LeadTime}} Days</p>
                                                <p *ngIf="item.LeadTime ==''">-</p>
                                            </td>

                                            <td>{{item.Quantity}}</td>
                                            <td>$ {{item.Rate}}</td>
                                            <td>$ {{item.Price}}</td>
                                            <td>{{item.WarrantyPeriod  | monthTransform }}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <!-- end table-responsive -->
                        </div>
                    </div>


                    <div class="row">

                        <div class="col-sm-12">
                            <div class="text-right">
                                <div class="table-responsive">
                                    <table class="table table-borderless bill mb-0">
                                        <tbody>
                                            <tr>
                                                <th width="90%" align="right" scope="row">
                                                    <p><b>Sub Total :</b></p>
                                                </th>
                                                <td>
                                                    <p>$ {{SalesQuoteInfo.TotalValue}}</p>
                                                </td>
                                            </tr>
                                            <tr>
                                                <th align="right" scope="row">
                                                    <p><b>AH Processing Fee :</b></p>
                                                </th>
                                                <td>
                                                    <p>$ {{SalesQuoteInfo.ProcessFee}}</p>
                                                </td>
                                            </tr>
                                            <tr>
                                                <th align="right" scope="row">
                                                    <p><b>Total Tax :</b></p>
                                                </th>
                                                <td>
                                                    <p>$ {{SalesQuoteInfo.TotalTax}}</p>
                                                </td>
                                            </tr>
                                            <tr>
                                                <th align="right" scope="row">
                                                    <p><b>Discount :</b></p>
                                                </th>
                                                <td>
                                                    <p>$ {{SalesQuoteInfo.Discount}}</p>
                                                </td>
                                            </tr>
                                            <tr>
                                                <th align="right" scope="row">
                                                    <p><b>Shipping :</b></p>
                                                </th>
                                                <td>
                                                    <p>$ {{SalesQuoteInfo.ShippingFee}}</p>
                                                </td>
                                            </tr>
                                            <tr class="grandouter">
                                                <th align="right" scope="row">
                                                    <p><b>Grand Total :</b></p>
                                                </th>
                                                <td>
                                                    <p>$ {{SalesQuoteInfo.GrandTotal}}</p>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>






                            </div>
                            <div class="clearfix"></div>
                        </div>
                        <!-- end col -->
                    </div>

                    <!-- end row -->
                    <div class="row">
                        <div class="col-sm-9">
                            <div class="clearfix pt-3">
                                <h6 class="text-muted">Notes:</h6>
                                <p class="text-muted linebreak smallfont">
                                    {{Quote_notes}}
                                </p>
                                <p class="text-muted linebreak smallfont" *ngFor="let note of NotesList">
                                    {{note.Notes}}
                                </p>
                                <p class="text-muted linebreak smallfont" *ngFor="let note of RRNotesList">
                                    {{note.Notes}}
                                </p>

                            </div>
                        </div>
                    </div>

                    <div class="row" *ngIf="hideAddress">
                        <div class="col-sm-12">
                            <div class="clearfix pt-3">
                                <h6>Attachment:</h6>
                                <div style="padding-bottom:15px;" class="row">

                                    <div style="margin-bottom:40px;" class="col-sm-3" *ngFor="let vattachment of AttachmentList; let i = index;">
                                        <div class="box h-100 d-flex justify-content-center flex-column brdimg">
                                            <span *ngIf="vattachment.AttachmentMimeType == 'application/pdf'">
                                                <a href="{{vattachment.Attachment}}" target="_blank">
                                                    <img src="assets/images/attachment/{{attachmentThumb['application/pdf'].thumb}}"
                                                        class="img-fluid"
                                                        ngbTooltip="{{vattachment.AttachmentOriginalFile}}" width="200"
                                                        alt="work-thumbnail">
                                                </a>
                                            </span>
                                            <span *ngIf="vattachment.AttachmentMimeType == 'image/jpeg'">
                                                <a href="{{vattachment.Attachment}}" target="_blank">
                                                    <img src="{{vattachment.Attachment}}" class="img-fluid"
                                                        ngbTooltip="{{vattachment.AttachmentOriginalFile}}" width="200"
                                                        alt="work-thumbnail">
                                                </a>
                                            </span>
                                            <span *ngIf="vattachment.AttachmentMimeType == 'image/png'">
                                                <a href="{{vattachment.Attachment}}" target="_blank">
                                                    <img src="{{vattachment.Attachment}}" class="img-fluid"
                                                        ngbTooltip="{{vattachment.AttachmentOriginalFile}}" width="200"
                                                        alt="work-thumbnail">
                                                </a>
                                            </span>
                                            <span *ngIf="vattachment.AttachmentMimeType == 'application/msword'">
                                                <a href="{{vattachment.Attachment}}" target="_blank">
                                                    <img src="assets/images/attachment/{{attachmentThumb['application/msword'].thumb}}"
                                                        class="img-fluid"
                                                        ngbTooltip="{{vattachment.AttachmentOriginalFile}}" width="200"
                                                        alt="work-thumbnail">
                                                </a>
                                            </span>
                                            <span *ngIf="vattachment.AttachmentMimeType == 'application/vnd.ms-excel'">
                                                <a href="{{vattachment.Attachment}}" target="_blank">
                                                    <img src="assets/images/attachment/{{attachmentThumb['application/vnd.ms-excel'].thumb}}"
                                                        class="img-fluid"
                                                        ngbTooltip="{{vattachment.AttachmentOriginalFile}}" width="200"
                                                        alt="work-thumbnail">
                                                </a>
                                            </span>
                                            <span *ngIf="vattachment.AttachmentMimeType == 'text/csv'">
                                                <a href="{{vattachment.Attachment}}" target="_blank">
                                                    <img src="assets/images/attachment/{{attachmentThumb['text/csv'].thumb}}"
                                                        class="img-fluid"
                                                        ngbTooltip="{{vattachment.AttachmentOriginalFile}}" width="200"
                                                        alt="work-thumbnail">
                                                </a>
                                            </span>
                                        </div>
                                        <p class="mb-0">
                                            <code class="text-primary">{{vattachment.AttachmentDesc}}</code>
                                        </p>


                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
                <!-- end card-box -->
            </div>
        </div>
        <!-- end col -->
    </div>

</ng-template>





<ngx-spinner #ngxSpinner bdColor="rgba(0, 0, 0, 0.8)" size="medium" color="#fff" type="ball-spin-clockwise" [fullScreen]="true"></ngx-spinner>