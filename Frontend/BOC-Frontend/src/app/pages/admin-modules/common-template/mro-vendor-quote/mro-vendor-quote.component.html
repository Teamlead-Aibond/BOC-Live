<div class="modal-header">
    <h4 class="modal-title">{{VendorName}} - Manage Vendor Quote</h4>
    <button type="button" class="close" (click)="modalRef.hide()" aria-hidden="true">Ã—</button>
</div>
<form class="form" role="form" [formGroup]="EditForm">
    <div class="modal-body">
        <div class="row">
            <!-- <div class="col-xl-6">
                <div class="form-group">
                    <label for="Customer">Root Cause</label>
                    <textarea class="form-control" placeholder="Root Cause" name="RouteCause" size="1"
                        formControlName="RouteCause"></textarea>
                    <span class="text-danger"
                        *ngIf="(EditFormControl.RouteCause.touched || submitted) && EditFormControl.RouteCause.errors?.required">
                        Root Cause is required
                    </span>
                </div>
            </div> -->
            <div class="col-xl-12" *ngIf="Status != 7 && VendorStatus <= 2 && Status < 5">
                <label for="VendorRefAttachment">
                    Attachment <span *ngIf="VendorRefAttachment != '' && VendorRefAttachment != null">[ <a
                            href="{{VendorRefAttachment}}" target="_blank">View File</a> ]</span>
                </label>
                <input type="file" class="form-control" (change)="fileProgress($event)">
                <input type="hidden" name="fileHidden" formControlName="VendorRefAttachment" />
            </div>
           
            <!-- <div class="col-xl-2">
                <div class="form-group">
                    <label for="Customer">Warranty Period</label>
                    <select class="custom-select" name="WarrantyPeriod" formControlName="WarrantyPeriod">
                        <option value="undefined" disabled>Select</option>
                        <option *ngFor="let warranty of warrantyList" value="{{warranty.WarrantyPeriodId}}">
                            {{warranty.WarrantyPeriodValue}}
                        </option>
                    </select>
                    <span class="text-danger"
                        *ngIf="(EditFormControl.WarrantyPeriod.touched || submitted) && EditFormControl.WarrantyPeriod.errors?.required">
                        Warranty Period is required
                    </span>
                </div>


            </div> -->
        </div>

        <div class="approve-quotedetail">
            <div class="row approve-quotedetail-headbg">
                <div class="col-2">Part # <span class="red">*</span></div>
                <div class="col-2">Part Description</div>
                <!-- <div class="col">Serial #</div> -->
                <div class="col-2">Lead Time</div>
                <div class="col">Quantity <span class="red">*</span></div>
                <div class="col">Unit Price <span class="red">*</span></div>
                <div class="col">Price <span class="red">*</span></div>
                <div class="col-2">Warranty Period</div>
                <div class="col">Action</div>
            </div>

            <div class="row approve-quotedetail-odd">
                <div class="col-2">
                    {{RRPartNo}}
                </div>
                <div class="col-2">
                    {{RRDescription}}
                </div>
                <!-- <div class="col">
                    {{RRSerialNo}}
                </div> -->
                <div class="col-2">
                    {{RRLeadTime}} <span *ngIf="LeadTime">Days</span>
                </div>
                <div class="col">
                    {{RRQuantity}}
                </div>
                <div class="col">
                    <span *ngIf="RRRate">{{RRRate}}</span>
                </div>
                <div class="col">
                    <span *ngIf="RRPrice">{{RRPrice}}</span>
                </div>
                <div class="col-2">
                    <span *ngIf="WarrantyPeriod">{{WarrantyPeriod}}</span>
                </div>
                <div class="col">
                </div>
            </div>

            <div formArrayName="VendorPartsList">
                <div *ngFor="let item of VendorPartsList.controls; let i = index;" [formGroupName]="i"
                    class="row approve-quotedetail-even">
                    <div class="col-2 nopad">
                        <div class="ng-autocomplete nopad">
                            <ng-autocomplete [data]="partList" [searchKeyword]="keyword" placeholder="Part #" [isLoading]="isLoading"
                                (selected)='selectEvent($event, i)' (inputChanged)='onChangeSearch($event, i)'
                                (inputCleared)='clearEvent($event, i)' (closed)='closeEvent($event, i)'
                                (inputFocused)='onFocused($event)' formControlName="PartNo1"
                                [itemTemplate]="itemTemplate" [notFoundTemplate]="notFoundTemplate">
                            </ng-autocomplete>
                        </div>
                        <input type="hidden" formControlName="RRVendorPartsId">
                        <input type="hidden" class="form-control pad5" readonly name="PartId" formControlName="PartId">
                        <input type="hidden" class="form-control pad5" readonly name="PartNo" formControlName="PartNo">
                        <div class="input-group mt-1" *ngIf="PON != ''">
                            <div class="input-group-prepend">
                                <span class="input-group-text1">PON ($): </span>
                            </div>
                            <input type="text" class="form-control input-text-only pon" readonly name="PON"
                                formControlName="PON">
                        </div>
                        <div class="input-group" *ngIf="LPP != ''">
                            <div class="input-group-prepend">
                                <span class="input-group-text1">LPP ($): </span>
                            </div>
                            <input type="text" class="form-control input-text-only pon" readonly name="LPP"
                                formControlName="LPP">
                        </div>
                    </div>
                    <div class="col-2">
                        <textarea class="form-control pad5" placeholder="Description..." name="Description"
                            formControlName="Description" rows="3">
                        </textarea>
                    </div>
                    <!-- <div class="col">

                    </div> -->
                    <div class="col-2">
                        <div class="input-group">
                            <input type="number" min="1" class="form-control" name="LeadTime" formControlName="LeadTime"
                                digitOnly>
                            <div class="input-group-append">
                                <span class="input-group-text">Day(s)</span>
                            </div>
                        </div>

                    </div>
                    <div class="col">
                        <input type="text" min="1" class="form-control" name="Quantity" formControlName="Quantity"
                            digitOnly (keyup)="calculatePrice(i)">
                    </div>
                    <div class="col">
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text">$</span>
                            </div>
                            <input id="Rate" type="text" name="Rate" formControlName="Rate" class="form-control pad5"
                                inputmode="numeric" pattern="^\d+(\.\d{1,2})?$" placeholder="0.00" digitOnly
                                decimal="true" (keyup)="calculatePrice(i)" />
                        </div>
                    </div>
                    <div class="col">
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text">$</span>
                            </div>
                            <input type="text" class="form-control pad5" readonly name="Price" formControlName="Price">
                        </div>
                    </div>
                    <div class="col-2">
                        <select class="custom-select" name="WarrantyPeriod" formControlName="WarrantyPeriod">
                            <option value="undefined" disabled>Select</option>
                            <option *ngFor="let warranty of warrantyList" value="{{warranty.WarrantyPeriodId}}">
                                {{warranty.WarrantyPeriodValue}}
                            </option>
                        </select>
                    </div>
                    <div class="col">
                        <input type="checkbox" checked="IsIncludeInQuote == 1?true:null" name="IsIncludeInQuote"
                            (change)="changeStatus(i)" formControlName="IsIncludeInQuote"> &nbsp;
                        <a (click)="removePart(i)" class=" text-danger" style="cursor: pointer;" *ngIf="i != 0">
                            <i class="remixicon-delete-bin-line delete-btn-ico"></i>
                        </a>

                    </div>
                </div>
            </div>

            <div class="row subouter">
                <div class="subtotal-left">
                    <button style="float:left;margin:15px;" class="btn btn-add btn-sm waves-effect" (click)="addPart()"
                        *ngIf="Status != 7 && VendorStatus <= 2 && Status < 5">
                        <!-- *ngIf="VendorStatus < 2" -->
                        <i style="float:left;" class="remixicon-add-fill mt-3"></i> Add New
                    </button><br>
                    <span class="text-danger mt-1" *ngIf="errorStatus == 1">
                        Please fill in all the mandatory fields.
                    </span>
                    <!-- <span class="text-danger" *ngIf="uniqueStatus == 1">
                        Part # should be unique
                    </span> -->
                </div>
                <div class="subtotal-block">
                    <div class="row">
                        <div class="col">Sub Total :</div>
                        <div class="col">
                            $ {{SubTotal}}
                            <input type="hidden" class="form-control" name="SubTotal" formControlName="SubTotal">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">Additional Charge :</div>
                        <div class="col">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text">$</span>
                                </div>
                                <input id="AdditionalCharge" type="text" name="AdditionalCharge"
                                    formControlName="AdditionalCharge" class="form-control" inputmode="numeric"
                                    pattern="^\d+(\.\d{1,2})?$" placeholder="0.00" digitOnly decimal="true"
                                    (keyup)="calculateTotal()" />
                                <!-- <input type="text" digitOnly class="form-control" name="AdditionalCharge"
                                    (keyup)="calculateTotal()" formControlName="AdditionalCharge"> -->
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">Total Tax :</div>
                        <div class="col">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text">$</span>
                                </div>
                                <input type="text" inputmode="numeric" pattern="^\d+(\.\d{1,2})?$" placeholder="0"
                                     decimal="true" class="form-control" name="TotalTax" readonly
                                    (keyup)="calculateTotal()" formControlName="TotalTax">
                            </div> &nbsp;
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text">%</span>
                                </div>
                                <input type="text" inputmode="numeric" pattern="^\d+(\.\d{1,2})?$" placeholder="0.00"
                                    max="100" digitOnly decimal="true" class="form-control" (keyup)="calculateTax()"
                                    name="TaxPercent" formControlName="TaxPercent">
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">Discount :</div>
                        <div class="col">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text">$</span>
                                </div>
                                <input id="Discount" type="text" name="Discount" formControlName="Discount"
                                    class="form-control" inputmode="numeric" pattern="^\d+(\.\d{1,2})?$"
                                    placeholder="0.00" digitOnly decimal="true" (keyup)="calculateTotal()" />
                                <!-- <input type="text" digitOnly class="form-control" name="Discount"
                                    (keyup)="calculateTotal()" formControlName="Discount"> -->
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">Shipping :</div>
                        <div class="col">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text">$</span>
                                </div>
                                <input id="Shipping" type="text" name="Shipping" formControlName="Shipping"
                                    class="form-control" inputmode="numeric" pattern="^\d+(\.\d{1,2})?$"
                                    placeholder="0.00"  decimal="true" (keyup)="calculateTotal()" />
                                <!-- <input type="text" digitOnly class="form-control" name="Shipping"
                                    (keyup)="calculateTotal()" formControlName="Shipping"> -->
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">Grand Total :</div>
                        <div class="col">
                            $ {{GrandTotal}}
                            <input type="hidden" class="form-control" name="GrandTotal" formControlName="GrandTotal">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-success waves-effect waves-light" (click)="onSubmit()"
            *ngIf="Status != 7 && VendorStatus <= 2 && Status < 5">Save</button>
        <button type="button" class="btn btn-purple waves-effect waves-light" [disabled]="btnDisabled"
            [ngClass]="{'class': (btnDisabled)? 'btn btn-light waves-effect waves-light': 'btn btn-purple waves-effect waves-light'}"
            *ngIf="Status != 7 && VendorStatus <= 2 && Status < 5" (click)="CreateCustomerQuote(VendorId, RRVendorId)">
            Submit & Create Customer Quote
        </button>
        <button type="button" class="btn btn-light waves-effect" (click)="modalRef.hide()">Close</button>
    </div>
</form>

<ng-template #itemTemplate let-item>
    <a [innerHTML]="item.PartNo"></a>
</ng-template>

<ng-template #notFoundTemplate let-notFound>
    <div [innerHTML]="notFound"></div>
</ng-template>