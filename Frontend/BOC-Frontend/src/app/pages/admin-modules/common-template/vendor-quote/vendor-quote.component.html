<div class="modal-header">
    <h4 class="modal-title">{{VendorName}} - Manage Vendor Quote</h4>
    <button type="button" class="close" (click)="modalRef.hide()" aria-hidden="true">Ã—</button>
</div>
<form class="form" role="form" [formGroup]="EditForm">
    <div class="modal-body">
        <div class="row">
            <div class="col-xl-6">
                <div class="form-group">
                    <label for="Customer">Root Cause</label>
                    <textarea class="form-control" placeholder="Root Cause" name="RouteCause" size="1"
                        formControlName="RouteCause"></textarea>
                    <span class="text-danger"
                        *ngIf="(EditFormControl.RouteCause.touched || submitted) && EditFormControl.RouteCause.errors?.required">
                        Root Cause is required
                    </span>
                </div>
            </div>
            <div class="col-xl-4" *ngIf="Status != 7 && VendorStatus <= 2 && Status < 5">
                <label for="VendorRefAttachment">
                    Attachment <span *ngIf="VendorRefAttachment != '' && VendorRefAttachment != null">[ <a
                            href="{{VendorRefAttachment}}" target="_blank">View File</a> ]</span>
                </label>
                <input type="file" class="form-control" (change)="fileProgress($event)">
                <input type="hidden" name="fileHidden" formControlName="VendorRefAttachment" />
            </div>
            <div class="col-xl-2">
                <div class="form-group">
                    <label for="Customer">Warranty Period</label>
                    <select class="custom-select" name="WarrantyPeriod" formControlName="WarrantyPeriod">
                        <option value="undefined" disabled>Select</option>
                        <option *ngFor="let warranty of warrantyList" value="{{warranty.WarrantyPeriodId}}">
                            {{warranty.WarrantyPeriodValue}}
                        </option>
                    </select>
                    <span class="text-danger"
                        *ngIf="(EditFormControl.WarrantyPeriod.touched || submitted) && EditFormControl.WarrantyPeriod.errors?.required">
                        Warranty Period is required
                    </span>
                </div>


            </div>
        </div>

        <div class="approve-quotedetail">
            <div class="row approve-quotedetail-headbg">
                <div class="col-2">Part # <span class="red">*</span></div>
                <div class="col-2">Part Description</div>
                <div class="col-1P5 col-1">Lead Time</div>
                <div class="col-1">Quantity <span class="red">*</span></div>
                <div class="col-1P7 col-2">Unit Price <span class="red">*</span></div>
                <div class="col-1P5 col-1">{{VAT_field_Name}}</div>
                <div class="col-1P7 col-2">Price <span *ngIf="IsDisplayBaseCurrencyValue==1"> / Price({{BaseCurrencySymbol}})</span><span class="red">*</span></div>
                <!-- <div class="col-1" *ngIf="IsDisplayBaseCurrencyValue==1">Price({{BaseCurrencySymbol}})<span class="red">*</span></div> -->
                <div class="col-P5 col-1">Action</div>
            </div>

            <div class="row approve-quotedetail-odd">
                <div class="col-2">
                    {{RRPartNo}}
                    <div class="input-group mt-1">
                        <div class="input-group-prepend">
                            <span class="input-group-text1">  Serial # : {{RRSerialNo}} </span>
                        </div>
                       
                    </div>
                </div>
                <div class="col-2">
                    {{RRDescription}}
                </div>
                
                <div class="col-1P5 col-1">
                    {{RRLeadTime}} <span *ngIf="LeadTime">Days</span>
                </div>
                <div class="col-1">
                    {{RRQuantity}}
                </div>
                <div class="col-1P7 col-2">
                    <span *ngIf="RRRate">{{RRRate}}</span>
                </div>
                <div class="col-1P5 col-1">
                </div>
                <div class="col-1P7 col-2">
                    <span *ngIf="RRPrice">{{RRPrice}}</span>
                </div>
                <!-- <div class="col-1" *ngIf="IsDisplayBaseCurrencyValue==1">
                </div> -->
                <div class="col-P5 col-1">
                </div>
            </div>

            <div formArrayName="VendorPartsList">
                <div *ngFor="let item of VendorPartsList.controls; let i = index;" [formGroupName]="i"
                    class="row approve-quotedetail-even">
                    <div class="col-2 nopad">
                        <div class="ng-autocomplete nopad">
                            <ng-autocomplete [data]="partList" [searchKeyword]="keyword" placeholder="Part #"
                                (selected)='selectEvent($event, i)' (inputChanged)='onChangeSearch($event, i)'
                                (inputCleared)='clearEvent($event, i)' (closed)='closeEvent($event, i)'
                                (inputFocused)='onFocused($event)' formControlName="PartNo1"
                                [itemTemplate]="itemTemplate" [notFoundTemplate]="notFoundTemplate">
                            </ng-autocomplete>
                        </div>
                        <input type="hidden" formControlName="RRVendorPartsId">
                        <input type="hidden" class="form-control pad5" readonly name="PartId" formControlName="PartId">
                        <input type="hidden" class="form-control pad5" readonly name="PartNo" formControlName="PartNo">
                     
                        <div class="input-group mt-1" *ngIf="PON != ''">
                            <div class="input-group-prepend">
                                <span class="input-group-text1">PON ({{item.value.ItemLocalCurrencySymbol}}): </span>
                            </div>
                            <input type="text" class="form-control input-text-only pon" readonly name="PON"
                                formControlName="PON">
                        </div>
                        <div class="input-group" *ngIf="LPP != ''">
                            <div class="input-group-prepend">
                                <span class="input-group-text1">LPP ({{item.value.ItemLocalCurrencySymbol}}): </span>
                            </div>
                            <input type="text" class="form-control input-text-only pon" readonly name="LPP"
                                formControlName="LPP">
                        </div>


                       
                    </div>
                    <div class="col-2">
                        <textarea class="form-control pad5" placeholder="Description..." name="Description"
                            formControlName="Description" rows="3">
                        </textarea>
                    </div>
                   
                    <div class="col-1P5 col-1">
                        <div class="input-group">
                            <input type="text"  class="form-control" name="LeadTime" formControlName="LeadTime"
                                digitOnly>
                            <div class="input-group-append">
                                <span class="input-group-text">Day(s)</span>
                            </div>
                        </div>

                    </div>
                    <div class="col-1">
                        <input type="text" min="1" class="form-control" name="Quantity" formControlName="Quantity"
                            digitOnly (keyup)="calculatePrice(i)">
                    </div>
                    <div class="col-1P7 col-2">
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text">{{item.value.ItemLocalCurrencySymbol}}</span>
                            </div>
                            <input id="Rate" type="text" name="Rate" formControlName="Rate" class="form-control pad5"
                                inputmode="numeric" pattern="^\d+(\.\d{1,2})?$" placeholder="0.00" digitOnly
                                decimal="true" (keyup)="calculatePrice(i)" />
                        </div>
                    </div>
                    <div class="col-1P5 col-1">
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <span class="input-group-text">%</span>
                        </div>
                    <input type="text" min="1" class="form-control" inputmode="numeric" pattern="^\d+(\.\d{1,2})?$" placeholder="0.00" digitOnly
                    decimal="true"
                         name="ItemTaxPercent" formControlName="ItemTaxPercent" 
                         (keyup)="calculatePrice(i)">
                    </div>
                    &nbsp;
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <span class="input-group-text">{{item.value.ItemLocalCurrencySymbol}}</span>
                        </div>
                        <input type="text" class="form-control"  readonly
                        name="Tax" formControlName="Tax">
                       
                    </div>
                    </div>
                    <div class="col-1P7 col-2">
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text">{{item.value.ItemLocalCurrencySymbol}}</span>
                            </div>
                            <input type="text" class="form-control pad5" readonly name="Price" formControlName="Price">
                        </div>
                        &nbsp;
                        <!-- <span *ngIf="IsDisplayBaseCurrencyValue==1"> / {{BaseCurrencySymbol}} {{displayBasePrice[i]}}</span> -->
                        <div class="input-group" *ngIf="IsDisplayBaseCurrencyValue==1">
                            <div class="input-group-prepend">
                                <span class="input-group-text">{{BaseCurrencySymbol}}</span>
                            </div>
                            <input type="text" class="form-control pad5" readonly name="BasePrice" formControlName="BasePrice">
                        </div>
                    </div>
                    <!-- <div class="col-1" *ngIf="IsDisplayBaseCurrencyValue==1">
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text">{{BaseCurrencySymbol}}</span>
                            </div>
                            <input type="text" class="form-control pad5" readonly name="BasePrice" formControlName="BasePrice">
                        </div>
                    </div> -->
                    <div class="col-P5 col-1">
                        <input type="checkbox" checked="IsIncludeInQuote == 1?true:null" name="IsIncludeInQuote"
                            (change)="changeStatus(i)" formControlName="IsIncludeInQuote"> &nbsp;
                            <!-- RRPartInfoPartId -->
                        <!-- <a (click)="removePart(i)" class=" text-danger" style="cursor: pointer;" *ngIf="i != 0">
                            <i class="remixicon-delete-bin-line delete-btn-ico"></i>
                        </a> -->
                        <a (click)="removePart(i)" class=" text-danger" style="cursor: pointer;" *ngIf="RRPartInfoPartId != item.value.PartId">
                            <i class="remixicon-delete-bin-line delete-btn-ico"></i>
                        </a>

                    </div>
                </div>
            </div>

            <div class="row subouter">
                <div class="subtotal-left">
                    <button style="float:left;margin:15px;" class="btn btn-add btn-sm waves-effect" (click)="addPart()"
                        *ngIf="Status != 7 && VendorStatus <= 2 && Status < 5">
                        <!-- *ngIf="VendorStatus < 2" -->
                        <i style="float:left;" class="remixicon-add-fill mt-3"></i> Add New
                    </button><br>
                    <span class="text-danger mt-1" *ngIf="errorStatus == 1">
                        Please fill in all the mandatory fields.
                    </span>
                    <!-- <span class="text-danger" *ngIf="uniqueStatus == 1">
                        Part # should be unique
                    </span> -->
                </div>
                <div class="subtotal-block">
                    <!-- <div class="row">
                        <div class="col">Sub Total :</div>
                        <div class="col">
                            $ {{SubTotal}}
                            <input type="hidden" class="form-control" name="SubTotal" formControlName="SubTotal">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">Additional Charge :</div>
                        <div class="col">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text">$</span>
                                </div>
                                <input id="AdditionalCharge" type="text" name="AdditionalCharge"
                                    formControlName="AdditionalCharge" class="form-control" inputmode="numeric"
                                    pattern="^\d+(\.\d{1,2})?$" placeholder="0.00" digitOnly decimal="true"
                                    (keyup)="calculateTotal()" />
                               
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">Total Tax :</div>
                        <div class="col">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text">$</span>
                                </div>
                                <input type="text" inputmode="numeric" pattern="^\d+(\.\d{1,2})?$" placeholder="0"
                                    digitOnly decimal="true" class="form-control" name="TotalTax" readonly
                                    (keyup)="calculateTotal()" formControlName="TotalTax">
                            </div> &nbsp;
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text">%</span>
                                </div>
                                <input type="text" inputmode="numeric" pattern="^\d+(\.\d{1,2})?$" placeholder="0.00"
                                    max="100" digitOnly decimal="true" class="form-control" (keyup)="calculateTax()"
                                    name="TaxPercent" formControlName="TaxPercent">
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">Discount :</div>
                        <div class="col">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text">$</span>
                                </div>
                                <input id="Discount" type="text" name="Discount" formControlName="Discount"
                                    class="form-control" inputmode="numeric" pattern="^\d+(\.\d{1,2})?$"
                                    placeholder="0.00" digitOnly decimal="true" (keyup)="calculateTotal()" />
                            
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">Shipping :</div>
                        <div class="col">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text">$</span>
                                </div>
                                <input id="Shipping" type="text" name="Shipping" formControlName="Shipping"
                                    class="form-control" inputmode="numeric" pattern="^\d+(\.\d{1,2})?$"
                                    placeholder="0.00" digitOnly decimal="true" (keyup)="calculateTotal()" />
                                
                            </div>
                        </div>
                    </div> -->
                   
                    <div class="row">
                        <div class="col">Grand Total :</div>
                        <div class="col">
                            {{Symbol}} {{GrandTotal}}
                            <input type="hidden" class="form-control" name="GrandTotal" formControlName="GrandTotal">
                        </div>
                    </div>
                    <div class="row" *ngIf="IsDisplayBaseCurrencyValue==1">
                        <div class="col">Grand Total ({{BaseCurrencySymbol}}) :</div>
                        <div class="col">
                            {{BaseCurrencySymbol}} {{BaseGrandTotal}}
                        </div>
                    </div>
                </div>
               
            </div>

           
        </div>
    </div>
    
    <div class="row">
        <div class="subtotal-left_vendor_info">
            &nbsp;
        </div>
        <div class="subtotal-block_vendor_info">
          
            <div class="row mb-2" *ngIf="Directed == '-' && VendorTypeName == 'OEM'">
                <div class="col-xl-2" style="font-size:18px;">Vendor:</div>
                <div class="row col-xl-10">
                    <div style="font-size:18px;color: red;font-weight: 800!important;">{{this.VendorTypeName}}</div>
                    <div style="font-size:18px;color:#f672a7;;font-weight: 800!important;" *ngIf="IsRMARequired == '1'" class="ml-2">RMA Required</div>
                    <div style="font-size:18px;color:#6559cc;font-weight: 800!important;" *ngIf="IsFlatRateRepair == '1'" class="ml-2">Flat Rate Repair</div>
                </div>
            </div>
            <div class="row mb-2" *ngIf="Directed != '-' && VendorTypeName != 'OEM'">
                <div class="col-xl-2"  style="font-size:18px;">Vendor :</div>
                <div  class="row col-xl-10">
                    <div style="font-size:18px;color: red;font-weight: 800!important;">Directed Vendor</div>
                    <div style="font-size:18px;color:#f672a7;;font-weight: 800!important;" *ngIf="IsRMARequired == '1'" class="ml-2">RMA Required</div>
                    <div style="font-size:18px;color:#6559cc;font-weight: 800!important;" *ngIf="IsFlatRateRepair == '1'" class="ml-2">Flat Rate Repair</div>
                
            </div>
            </div>
            <div class="row mb-2" *ngIf="VendorTypeName == 'OEM' && Directed != '-'">
                <div class="col-xl-2" style="font-size:18px;">Vendor :</div>
                <div  class="row col-xl-10">
                    <div style="font-size:18px;color: red;font-weight: 800!important;">OEM & Directed Vendor</div>
                    <div style="font-size:18px;color:#f672a7;font-weight: 800!important;" *ngIf="IsRMARequired == '1'" class="ml-2">RMA Required</div>
                    <div style="font-size:18px;color:#6559cc;font-weight: 800!important;" *ngIf="IsFlatRateRepair == '1'" class="ml-2">Flat Rate Repair</div>
                </div>
            </div>
        </div>
       
    </div>

   
    <div class="modal-footer">
        <button type="button" class="btn btn-success waves-effect waves-light" (click)="onSubmit()"
            *ngIf="Status != 7 && VendorStatus <= 2 && Status < 5">Save</button>
        <button type="button" class="btn btn-purple waves-effect waves-light" [disabled]="btnDisabled"
            [ngClass]="{'class': (btnDisabled)? 'btn btn-light waves-effect waves-light': 'btn btn-purple waves-effect waves-light'}"
            *ngIf="Status != 7 && VendorStatus <= 2 && Status < 5" (click)="CreateCustomerQuote(VendorId, RRVendorId)">
            Submit & Create Customer Quote
        </button>
        <button type="button" class="btn btn-light waves-effect" (click)="modalRef.hide()">Close</button>
    </div>
</form>

<ng-template #itemTemplate let-item>
    <a [innerHTML]="item.PartNo"></a>
</ng-template>

<ng-template #notFoundTemplate let-notFound>
    <div [innerHTML]="notFound"></div>
</ng-template>