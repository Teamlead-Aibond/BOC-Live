<div class="container-fluid" *ngIf="IsMROCreate">
  <app-page-title
    title="Add MRO"
    [breadcrumbItems]="breadCrumbItems"
  ></app-page-title>

  <div class="row">
    <div class="col-xl-12">
      <form
        class="form"
        role="form"
        (ngSubmit)="onSubmit(AddForm)"
        [formGroup]="AddForm"
      >
        <div class="row">
          <div class="col-12">
            <div class="sticky-container">
              <div
                id="so-groups"
                class="right so-groups-sticky hidden-xs"
                style="top: 198px"
              >
                <!-- <a (click)="reLoad()" data-target="popup" data-popup="#popup-revert">
                                    <span>Reset</span> <i class="mdi mdi-refresh"></i>
                                </a> -->
                <a (click)="onSubmit(0)" *ngIf="showsave">
                  <span>Save</span> <i class="mdi mdi-content-save"></i>
                </a>
                <a class="bg-danger" routerLink="/admin/mro/list">
                  <span>Back</span><i class="fas fa-arrow-left"></i>
                </a>
              </div>
            </div>
          </div>
        </div>
        <div class="card-box">
          <div class="row">
            <div class="col-xl-12 float-left">
              <span class="alert alert-warning" *ngIf="PriorityNotes != ''">
                <i class="mdi mdi-alert-outline mr-1"></i> {{ PriorityNotes }}
              </span>
            </div>
          </div>

          <div class="row">
            <div class="col-xl-12 float-left">
              <div class="repair-left">
                <div class="row">
                  <h4 class="page-title bluetxt ml-2 mb-3">Basic Details</h4>
                </div>

                <div class="row">
                  <div class="col-xl-6 float-left">
                    <div class="form-group">
                      <label for="Customer"
                        >Customer <span class="red">*</span></label
                      >
                      <ng-autocomplete
                        class="ng-autocomplete"
                        placeholder="Enter Customer Name"
                        [data]="CustomersList"
                        [isLoading]="isLoadingCustomer"
                        [searchKeyword]="keywordForCustomer"
                        (selected)="selectCustomerEvent($event)"
                        (inputChanged)="onChangeCustomerSearch($event)"
                        (inputCleared)="clearEventCustomer($event)"
                        [itemTemplate]="CustomeritemTemplate"
                        [notFoundTemplate]="CustomernotFoundTemplate"
                        debounceTime="1000"
                      >
                      </ng-autocomplete>
                      <ng-template #CustomeritemTemplate let-item>
                        <a [innerHTML]="item.CompanyName"></a>
                      </ng-template>

                      <ng-template #CustomernotFoundTemplate let-notFound>
                        <div [innerHTML]="notFound"></div>
                      </ng-template>
                      <span
                        class="text-danger"
                        style="position: relative; top: 31px"
                        *ngIf="
                          (AddFormControl.CustomerId.touched || submitted) &&
                          AddFormControl.CustomerId.errors?.required
                        "
                      >
                        Customer is required
                      </span>
                    </div>

                    <br />

                    <div class="row">
                      <div class="col-xl-6">
                        <div class="form-group">
                          <label>Bill Address:<span class="red">*</span></label>
                          <ng-select
                            [items]="customerAddressList"
                            formControlName="CustomerBillToId"
                            name="CustomerBillToId"
                            placeholder="Select"
                            bindLabel="title"
                            bindValue="AddressId"
                          >
                          </ng-select>
                          <span
                            class="text-danger"
                            *ngIf="
                              (AddFormControl.CustomerBillToId.touched ||
                                submitted) &&
                              AddFormControl.CustomerBillToId.errors?.required
                            "
                          >
                            Bill Address is required
                          </span>
                        </div>
                      </div>
                      <div class="col-xl-6">
                        <div class="form-group">
                          <label>Ship Address:<span class="red">*</span></label>

                          <ng-select
                            [items]="customerAddressList"
                            formControlName="CustomerShipToId"
                            name="CustomerShipToId"
                            placeholder="Select"
                            bindLabel="title"
                            bindValue="AddressId"
                          >
                          </ng-select>

                          <span
                            class="text-danger"
                            *ngIf="
                              (AddFormControl.CustomerShipToId.touched ||
                                submitted) &&
                              AddFormControl.CustomerShipToId.errors?.required
                            "
                          >
                            Ship Address is required
                          </span>
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-xl-6">
                        <div class="form-group">
                          <label>Terms:<span class="red">*</span></label>

                          <select
                            class="form-control"
                            name="TermsId"
                            formControlName="TermsId"
                          >
                            <option value="">Select</option>
                            <option
                              *ngFor="let item of TermsList"
                              value="{{ item.TermsId }}"
                            >
                              {{ item.TermsName }}
                            </option>
                          </select>
                          <span
                            class="text-danger"
                            *ngIf="
                              (AddFormControl.TermsId.touched || submitted) &&
                              AddFormControl.TermsId.errors?.required
                            "
                          >
                            Terms is required
                          </span>
                        </div>
                      </div>
                      <div class="col-xl-6">
                        <div class="form-group">
                          <label>Tax Type:<span class="red">*</span></label>

                          <select
                            class="form-control"
                            name="TaxType"
                            formControlName="TaxType"
                          >
                            <option value="undefined" disabled>Select</option>
                            <option
                              *ngFor="let item of taxType"
                              value="{{ item.TaxType }}"
                            >
                              {{ item.TaxTypeName }}
                            </option>
                          </select>
                          <span
                            class="text-danger"
                            *ngIf="
                              (AddFormControl.TaxType.touched || submitted) &&
                              AddFormControl.TaxType.errors?.required
                            "
                          >
                            TaxType is required
                          </span>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="col-xl-6 float-left">
                    <div class="form-group">
                      <label for="Customer">Notes</label>
                      <textarea
                        class="form-control"
                        placeholder="Notes..."
                        name="Notes"
                        formControlName="Notes"
                        rows="5"
                      ></textarea>
                    </div>
                  </div>
                </div>

                <h4 class="page-title bluetxt mb-10">
                  <button
                    (click)="addPart()"
                    type="button"
                    class="btn btn-add waves-effect"
                  >
                    <i class="remixicon-add-fill mt-3"></i> Add</button
                  >Inventory Quotes (Optional)
                </h4>

                <div class="row">
                  <div class="col-xl-6 mt3 nopad float-left">
                    <div class="col-xl-12 float-left ccs nopad">
                      <p class="text-left mtp">
                        <strong>Vendor : </strong>
                        <span class="customerbg mro-title">Aibond</span>
                      </p>
                    </div>
                    <!-- <div class="col-xl-9 float-left">
                                    <p><span class="customerbg mro-title">AH_Group</span>
                                    </p>
                                </div> -->
                  </div>
                  <div class="col-xl-6 float-left">&nbsp;</div>
                </div>

                <div class="approve-quotedetail">
                  <div class="row approve-quotedetail-headbg">
                    <div class="col-2">Part #</div>
                    <div class="col-2">Part Description</div>
                    <div class="col-2">Lead Time</div>
                    <div class="col">Quantity</div>
                    <div class="col">Unit Price</div>
                    <div class="col">Price</div>
                    <div class="col">Warranty Period</div>
                    <div class="col">Action</div>
                  </div>

                  <div formArrayName="QuoteItem">
                    <div
                      *ngFor="let item of QuoteItem.controls; let i = index"
                      [formGroupName]="i"
                      class="row approve-quotedetail-even"
                    >
                      <div class="col-2 mro-auto nopad">
                        <div class="ng-autocomplete nopad">
                          <!-- <ng-autocomplete [data]="filteredData" [isLoading]="isLoading"
                                                        [searchKeyword]="keyword" placeholder="Enter Part #"
                                                        (selected)='selectEvent($event, i)'
                                                        (inputChanged)='onChangeSearch($event, i)'
                                                        (inputCleared)='clearEvent($event, i)'
                                                        (closed)='closeEvent($event, i)'
                                                        (inputFocused)='onFocused($event)' formControlName="Part"
                                                        [itemTemplate]="itemTemplate"
                                                        [notFoundTemplate]="notFoundTemplate">
                                                    </ng-autocomplete> -->

                          <ng-select
                            [items]="parts$ | async"
                            bindLabel="PartNo"
                            [typeahead]="partsInput$"
                            [placeholder]="'Enter Part #'"
                            (change)="selectEvent($event, i)"
                            formControlName="Part"
                          >
                          </ng-select>
                        </div>
                        <div class="text-danger" *ngIf="selectPart == 'Error'">
                          Part Number is required
                        </div>
                        <input
                          type="hidden"
                          class="form-control pad5"
                          readonly
                          name="PartId"
                          formControlName="PartId"
                        />
                        <input
                          type="hidden"
                          class="form-control pad5"
                          readonly
                          name="PartNo"
                          formControlName="PartNo"
                        />
                        <div class="input-group mt-1" *ngIf="PON != ''">
                          <div class="input-group-prepend">
                            <span class="input-group-text1">PON ($): </span>
                          </div>
                          <input
                            type="text"
                            class="form-control input-text-only pon"
                            readonly
                            name="PON"
                            formControlName="PON"
                          />
                        </div>
                      </div>
                      <div class="col-2">
                        <textarea
                          class="form-control pad5"
                          placeholder="Description..."
                          name="PartDescription"
                          formControlName="PartDescription"
                          rows="3"
                        ></textarea>
                      </div>

                      <div class="col-2">
                        <div class="input-group">
                          <input
                            type="number"
                            min="1"
                            class="form-control"
                            name="LeadTime"
                            formControlName="LeadTime"
                            digitOnly
                          />
                          <div class="input-group-append">
                            <span class="input-group-text">Day(s)</span>
                          </div>
                        </div>
                      </div>
                      <div class="col">
                        <input
                          type="text"
                          min="1"
                          class="form-control"
                          name="Quantity"
                          formControlName="Quantity"
                          digitOnly
                          (keyup)="calculatePrice(i)"
                        />
                        <!-- <span class="text-danger"
                                                    *ngIf="(item['controls'].Quantity?.touched || submitted) && item['controls'].Quantity?.errors?.required">
                                                    Quantity is required
                                                </span> -->
                      </div>
                      <div class="col">
                        <div class="input-group">
                          <div class="input-group-prepend">
                            <span class="input-group-text">$</span>
                          </div>
                          <input
                            id="Rate"
                            type="text"
                            name="Rate"
                            formControlName="Rate"
                            class="form-control pad5"
                            inputmode="numeric"
                            pattern="^\d+(\.\d{1,2})?$"
                            placeholder="0.00"
                            digitOnly
                            decimal="true"
                            (keyup)="calculatePrice(i)"
                          />
                        </div>

                        <!-- <span class="text-danger"
                                                    *ngIf="(item['controls'].Rate?.touched || submitted) && item['controls'].Rate?.errors?.required">
                                                    Rate is required
                                                </span> -->
                      </div>
                      <div class="col">
                        <div class="input-group">
                          <div class="input-group-prepend">
                            <span class="input-group-text">$</span>
                          </div>
                          <input
                            type="text"
                            class="form-control pad5"
                            readonly
                            name="Price"
                            formControlName="Price"
                          />
                        </div>
                        <!-- <span class="text-danger"
                                                    *ngIf="(item['controls'].Price?.touched || submitted) && item['controls'].Price?.errors?.required">
                                                    Price is required
                                                </span> -->
                      </div>
                      <div class="col">
                        <div class="input-group">
                          <select
                            class="custom-select"
                            name="WarrantyPeriod"
                            formControlName="WarrantyPeriod"
                          >
                            <option value="undefined">Select</option>
                            <option
                              *ngFor="let warranty of warrantyList"
                              value="{{ warranty.WarrantyPeriodId }}"
                            >
                              {{ warranty.WarrantyPeriodValue }}
                            </option>
                          </select>
                          <!-- <span class="text-danger"
                                                        *ngIf="(item['controls'].WarrantyPeriod?.touched || submitted) && item['controls'].WarrantyPeriod?.errors?.required">
                                                        WarrantyPeriod is required
                                                    </span> -->
                        </div>
                      </div>
                      <div class="col">
                        <a
                          (click)="removePart(i)"
                          class="text-danger"
                          style="cursor: pointer"
                          *ngIf="i != 0"
                        >
                          <i
                            class="remixicon-delete-bin-line delete-btn-ico"
                          ></i>
                        </a>
                      </div>
                    </div>
                  </div>

                  <div class="row subouter">
                    <div class="subtotal-left">&nbsp;</div>
                    <div class="subtotal-block">
                      <div class="row">
                        <div class="col">Sub Total :</div>
                        <div class="col">
                          $ {{ SubTotal }}
                          <input
                            type="hidden"
                            class="form-control"
                            name="TotalValue"
                            formControlName="TotalValue"
                          />
                        </div>
                      </div>
                      <div class="row">
                        <div class="col">Additional Charge :</div>
                        <div class="col">
                          <div class="input-group">
                            <div class="input-group-prepend">
                              <span class="input-group-text">$</span>
                            </div>
                            <input
                              id="ProcessFee"
                              type="text"
                              name="ProcessFee"
                              formControlName="ProcessFee"
                              class="form-control"
                              inputmode="numeric"
                              pattern="^\d+(\.\d{1,2})?$"
                              placeholder="0.00"
                              digitOnly
                              decimal="true"
                              (keyup)="calculateTotal()"
                            />
                            <!-- <input type="text" digitOnly class="form-control" name="AdditionalCharge"
                                                                (keyup)="calculateTotal()" formControlName="AdditionalCharge"> -->
                          </div>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col">Total Tax :</div>
                        <div class="col">
                          <div class="input-group">
                            <div class="input-group-prepend">
                              <span class="input-group-text">$</span>
                            </div>
                            <input
                              type="text"
                              inputmode="numeric"
                              pattern="^\d+(\.\d{1,2})?$"
                              placeholder="0.00"
                              digitOnly
                              decimal="true"
                              class="form-control"
                              name="TotalTax"
                              readonly
                              (keyup)="calculateTotal()"
                              formControlName="TotalTax"
                            />
                          </div>
                          &nbsp;
                          <div class="input-group">
                            <div class="input-group-prepend">
                              <span class="input-group-text">%</span>
                            </div>
                            <input
                              type="text"
                              inputmode="numeric"
                              pattern="^\d+(\.\d{1,2})?$"
                              placeholder="0.00"
                              max="100"
                              digitOnly
                              decimal="true"
                              class="form-control"
                              (keyup)="calculateTax()"
                              name="TaxPercent"
                              formControlName="TaxPercent"
                            />
                          </div>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col">Discount :</div>
                        <div class="col">
                          <div class="input-group">
                            <div class="input-group-prepend">
                              <span class="input-group-text">$</span>
                            </div>
                            <input
                              id="Discount"
                              type="text"
                              name="Discount"
                              formControlName="Discount"
                              class="form-control"
                              inputmode="numeric"
                              pattern="^\d+(\.\d{1,2})?$"
                              placeholder="0.00"
                              digitOnly
                              decimal="true"
                              (keyup)="calculateTotal()"
                            />
                            <!-- <input type="text" digitOnly class="form-control" name="Discount"
                                                                (keyup)="calculateTotal()" formControlName="Discount"> -->
                          </div>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col">Shipping :</div>
                        <div class="col">
                          <div class="input-group">
                            <div class="input-group-prepend">
                              <span class="input-group-text">$</span>
                            </div>
                            <input
                              id="ShippingFee"
                              type="text"
                              name="ShippingFee"
                              formControlName="ShippingFee"
                              class="form-control"
                              inputmode="numeric"
                              pattern="^\d+(\.\d{1,2})?$"
                              placeholder="0.00"
                              digitOnly
                              decimal="true"
                              (keyup)="calculateTotal()"
                            />
                            <!-- <input type="text" digitOnly class="form-control" name="Shipping"
                                                                (keyup)="calculateTotal()" formControlName="Shipping"> -->
                          </div>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col">Grand Total :</div>
                        <div class="col">
                          $ {{ GrandTotal }}
                          <input
                            type="hidden"
                            class="form-control"
                            name="GrandTotal"
                            formControlName="GrandTotal"
                          />
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>
<ng-template #itemTemplate let-item>
  <a [innerHTML]="item.PartNo"></a>
</ng-template>

<ng-template #notFoundTemplate let-notFound>
  <div [innerHTML]="notFound"></div>
</ng-template>

<div class="container-fluid" *ngIf="!IsMROCreate">
  <div class="account-pages mt-5 mb-5">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-md-8 col-lg-6 col-xl-5">
          <div class="card bg-pattern">
            <div class="card-body p-4">
              <div class="text-center">
                <a routerLink="/">
                  <span
                    ><img
                      src="assets/projects/ah-group/full_logo.png"
                      alt=""
                      height="22"
                  /></span>
                </a>
              </div>

              <div class="text-center mt-4">
                <h1 class="text-error">401</h1>
                <h3 class="mt-3 mb-2">Access Denied!</h3>
                <p class="text-muted mb-3">
                  You don't have permission to access this page.
                </p>

                <a
                  routerLink="/admin/dashboard/ah-dashboard"
                  class="btn btn-success waves-effect waves-light"
                  >Back to Dashboard</a
                >
              </div>
            </div>
            <!-- end card-body -->
          </div>
          <!-- end card -->
        </div>
        <!-- end col -->
      </div>
      <!-- end row -->
    </div>
    <!-- end container -->
  </div>
</div>
