<div class="container-fluid" *ngIf="IsViewEnabled">
    <app-page-title title="RR Vendor Quote Attachment List" [breadcrumbItems]="breadCrumbItems"></app-page-title>
    <div class="row">
        <div class="col-12">
            <div class="sticky-container">
                <div id="so-groups" class="right so-groups-sticky hidden-xs" style="top:198px">
                    <a (click)="onAllSave()">
                        <span>Save All Recommended Price</span> <i class="mdi mdi-content-save"></i>
                    </a>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-12">
            <div class="card-box mpb10">
                <div class="row">
                    <!-- <div class="col-xl-12 nopad"> -->
                    <div class="col-12 col-sm-4 col-md-4 col-xl-2">

                        <label class="control-label">Customer Group</label>
                        <ng-select (change)="changeCustomerGroup($event)" [items]="customerGroupList" [multiple]="false" [closeOnSelect]="true" [searchable]="true" [virtualScroll]="true" placeholder="Select" bindLabel="CustomerGroupName" bindValue="CustomerGroupId" [(ngModel)]="CustomerGroupId">
                        </ng-select>
                    </div>
                    <div class="col-12 col-sm-4 col-md-4 col-xl-4">
                        <label class="control-label">Customers</label>
                        <ng-select [items]="customers$ | async" [typeahead]="customersInput$" [loading]="loadingCustomers" [multiple]="true" [closeOnSelect]="false" [searchable]="true" [virtualScroll]="true" placeholder="Select" bindLabel="CustomerCode" bindValue="CustomerId"
                            [(ngModel)]="CompanyName">
                            <ng-template ng-header-tmp *ngIf="CustomersList.length > 0">
                                <button (click)="selectAll()" class="btn btn-sm btn-link">Select all</button>
                            </ng-template>
                            <ng-template ng-multi-label-tmp let-items="items" let-clear="clear">
                                <div class="ng-value" *ngFor="let item of items | slice:0:1">
                                    <span class="ng-value-label">{{item.CompanyName}}</span>
                                    <span class="ng-value-icon right" (click)="clear(item)" aria-hidden="true">Ã—</span>
                                </div>
                                <div class="ng-value" *ngIf="items.length > 1">
                                    <span class="ng-value-label">+ {{items.length - 1}} more...</span>
                                </div>
                            </ng-template>
                            <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
                                <input id="item-{{index}}" type="checkbox" [checked]="item$.selected" [ngModel]="item$.selected" /> {{item.CompanyName}}
                            </ng-template>
                        </ng-select>
                    </div>
                    <div class="col-12 col-sm-4 col-md-4 col-xl-4">
                        <label class="control-label">Vendor Name</label>
                        <ng-autocomplete class="ng-autocomplete" placeholder="Enter Vendor Name" [data]="VendorsList" [isLoading]="isLoadingVendor" [searchKeyword]="keywordForVendor" [(ngModel)]="VendorName" (inputCleared)='clearVendorEvent($event)' (selected)='selectVendorEvent($event)'
                            (inputChanged)='onChangeVendorSearch($event)' (inputFocused)='onFocused($event)' [itemTemplate]="itemVendorTemplate" [notFoundTemplate]="notFoundVendorTemplate" debounceTime="1000">
                        </ng-autocomplete>
                        <ng-template #itemVendorTemplate let-item>
                            <a [innerHTML]="item.VendorName"></a>
                        </ng-template>

                        <ng-template #notFoundVendorTemplate let-notFound>
                            <div [innerHTML]="notFound"></div>
                        </ng-template>
                    </div>

                    <div class="col-12 col-sm-4 col-md-4 col-xl-2">
                        <label class="control-label">RRNo</label>
                        <ng-autocomplete class="ng-autocomplete" placeholder="Enter Repair Request #" [data]="RRList" [isLoading]="isLoadingRR" [searchKeyword]="keywordForRR" (selected)='selectRREvent($event)' (inputCleared)='clearRREvent($event)' [(ngModel)]="RRNo" (inputChanged)='onChangeRRSearch($event)'
                            (inputFocused)='onFocused($event)' [itemTemplate]="RRitemTemplate" [notFoundTemplate]="notFoundRRTemplate" debounceTime="1000">
                        </ng-autocomplete>
                        <ng-template #RRitemTemplate let-item>
                            <a [innerHTML]="item.RRNo"></a>
                        </ng-template>

                        <ng-template #notFoundRRTemplate let-notFound>
                            <div [innerHTML]="notFound"></div>
                        </ng-template>
                    </div>
                    <div class="col-12 col-sm-4 col-md-4 col-xl-2">
                        <label for="lastname">RR Status</label>
                        <select class="custom-select" [(ngModel)]="StatusChangeId">
                            <option value="">Select</option>
                            <option [value]="status.id" *ngFor="let status of RRStatus">{{status.title}}</option>

                        </select>
                    </div>

                    <div class="col-12 col-sm-4 col-md-4 col-xl-2">
                        <label class="control-label">Price Updated
                            By</label>
                        <ng-select class="" name="ModifiedBy" [(ngModel)]="ModifiedBy" [ngModelOptions]="{standalone: true}" bindLabel="title" bindValue="UserId" [items]="adminListddl" [searchable]="true" placeholder="Updated By">
                        </ng-select>
                    </div>

                    <div class="col-12 col-sm-4 col-md-4 col-xl-2">
                        <label class="control-label">Created Date</label>
                        <div class="input-group clockpicker">
                            <input ngbDatepicker class="form-control" placeholder="MM/DD/YYYY" #d="ngbDatepicker" [(ngModel)]="CreatedDate" readonly>
                            <div class="input-group-append" (click)="d.toggle()">
                                <span class="input-group-text"><i class="mdi mdi-calendar"></i></span>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-sm-4 col-md-4 col-xl-2" style="margin-top: 29px !important">
                        <input type="button" class="btn btn-primary btn-md" value="Search" (click)="onSearch()" />&nbsp;&nbsp;&nbsp;
                        <input type="button" class="btn btn-secondary btn-md" value="Clear" (click)="onClear()" />
                    </div>
                    <!-- </div> -->
                </div>
                <div class="row collapse pt-2 show">
                    <div class="col-12 col-sm-6 col-md-6 col-xl-6">
                        <!-- <input type="button" class="btn btn-primary btn-md" value="Search" (click)="onSearch()" />&nbsp;&nbsp;&nbsp;
                        <input type="button" class="btn btn-secondary btn-md" value="Clear" (click)="onClear()"/> -->
                    </div>
                    <div class="col-12 col-sm-6 col-md-6 col-xl-6">
                        <div class="text-right mt-3 mt-lg-0">
                            <label class="form-check-label" style="margin-bottom: 15px; margin-right: 34px;" ngbTooltip="Select All for Generate Link"> Select All &nbsp;&nbsp;
                                <input class="form-check-input" type="checkbox" [checked]="gridCheckAll"
                                    (change)="gridAllRowsCheckBoxChecked($event)" />
                                <span class="form-check-sign">
                                    <span class="check"></span>
                                </span>
                            </label>
                            <a class="btn text-white btn-secondary waves-effect waves-light" (click)="generateLink()"><i
                                    class="mdi mdi-link mr-1"></i> Generate Link
                            </a>&nbsp;&nbsp;
                            <a *ngIf="IsAddEnabled" class="btn text-white btn-success waves-effect waves-light" (click)="onAddVendorQuoteAttachment()"><i class="mdi mdi-plus-circle mr-1"></i> Add
                                Vendor Attachment
                            </a>

                        </div>
                        <!-- <div class="form-check">
                            <label class="form-check-label" style="margin-bottom: 15px;"> Select All
                                <input class="form-check-input" type="checkbox" [checked]="gridCheckAll"
                                    (change)="gridAllRowsCheckBoxChecked($event)" />
                                <span class="form-check-sign">
                                    <span class="check"></span>
                                </span>
                            </label>
                        </div> -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="dataTables_length" id="datatable-angular-rr_length">
        <label>Show 
            <select name="datatable-angular-rr_length" (change)="changeLength($event)" aria-controls="datatable-angular-rr" class="">
                <option value="10">10</option>
                <option value="20">20</option>
                <option value="30">30</option>
                <option value="40">40</option>
                <option value="50">50</option>
                <!-- <option value="-1">All</option> -->
            </select> entries
        </label>
    </div>

    <div class="row justify-content-md-between align-items-md-center" *ngFor="let list of Lists; let i=index">
        <div class="col-xl-12 mb-0">
            <div class="card ca-spc">
                <div class="col-12 col-xl-7 col-sm-7 float-left">
                    <div class="pdfdoc">
                        <div class='embed-responsive'>
                            <embed [src]="list.pdfSrc" type="application/pdf" width="100%" height="110%" />
                        </div>
                    </div>
                </div>
                <div class="col-12 col-xl-5 col-sm-5 float-left">
                    <div class="row">
                        <div class="col-xl-12">
                            <div style="padding-bottom:1rem !important;" class="card-box quotelistwrap">

                                <div class="row">
                                    <div class="col-xl-12 nopad">
                                        <div class="col-xl-6 nopad float-left">
                                            <label class="form-check-label" style="margin-bottom: 15px; margin-right: 34px;" ngbTooltip="Select for Generate Link"> Select &nbsp;
                                                <span>
                                                    <input type="checkbox" class="checkbox cck"
                                                        (change)="rowCheckBoxChecked($event, list.VQAttachmentId)"
                                                        [checked]="list.checked">
                                                </span>
                                            </label>

                                        </div>
                                        <div class="col-xl-6 float-left">
                                            <span *ngIf="IsDeleteEnabled" (click)="onDeleteVendorQuoteAttachment(list.VQAttachmentId)"><em
                                                    class="mdi mdi-delete editicon cursor-pointer float-right"
                                                    style="color: #ff6e6e;"
                                                    ngbTooltip="Delete Vendor Quote Attachment"></em></span>
                                            <span style="color: #09518e;" *ngIf="IsEditEnabled" (click)="onEditVendorQuoteAttachment(list.VQAttachmentId)"><em
                                                    class="mdi mdi-pencil-box-outline editicon cursor-pointer float-right"
                                                    ngbTooltip="Edit Vendor Quote Attachment"></em></span>
                                        </div>
                                    </div>
                                </div>

                                <!-- <table class="table rrquote mb-0">
                                    <tbody>
                                        <tr>
                                            <th><label class="col-sm-6 col-form-label" for="simpleinput">RRNo:</label>
                                            </th>
                                            <td><span class="badge badge-success btn-xs" style="font-size: 1.25rem;">
                                                    <a [routerLink]="[ '/admin/repair-request/edit']"
                                                        [queryParams]="{RRId: list.RRId}" target="_blank"
                                                        routerLink="#" style="cursor: pointer;">
                                                        {{list.RRNo}}
                                                    </a>
                                                </span>
                                            </td>
                                            <th><label class="col-sm-5 col-form-label" for="simpleinput">Current
                                                    Status:</label></th>
                                            <td><span class="badge badge-info btn-xs">{{list.StatusName}}</span></td>
                                        </tr>
                                    </tbody>
                                </table> -->


                                <div class="row">
                                    <div class="col-xl-12 nopad">
                                        <div class="col-xl-6 float-left">
                                            <div class="form-group row">
                                                <label class="col-sm-6 col-form-label" for="simpleinput">RRNo:</label>
                                                <div class="col-sm-6 nopad">


                                                    <span class="badge badge-success btn-xs" style="font-size: 1.25rem;">
                                                        <a [routerLink]="[ '/admin/repair-request/edit']"
                                                            [queryParams]="{RRId: list.RRId}" target="_blank"
                                                            routerLink="#" style="cursor: pointer;">
                                                            {{list.RRNo}}
                                                        </a>
                                                    </span>


                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-xl-6 float-left">
                                            <div class="form-group row">
                                                <label class="col-sm-5 col-form-label" for="simpleinput">Current
                                                    Status:</label>
                                                <div class="col-sm-7 nopad"><span class="badge badge-info btn-xs">{{list.StatusName}}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-xl-12 nopad">
                                        <div class="col-xl-6 float-left">
                                            <div class="form-group row">
                                                <label class="col-sm-6 col-form-label" for="simpleinput">Vendor:</label>
                                                <p>{{list.VendorName}}</p>
                                            </div>
                                        </div>
                                        <div class="col-xl-6 float-left">
                                            <div class="form-group row">
                                                <label class="col-sm-5 col-form-label" for="simpleinput">Customer:</label>
                                                <p>{{list.CompanyName}}</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-xl-12 nopad">
                                        <div class="col-xl-6 float-left">
                                            <div class="form-group row">
                                                <label class="col-sm-6 col-form-label" for="simpleinput">PON:</label>
                                                <div class="col-sm-6 nopad">
                                                    <p>{{list.PONCurrencySymbol}} {{list.PartPON}}</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-xl-6 float-left">
                                            <div class="form-group row">
                                                <label class="col-sm-5 col-form-label" for="simpleinput">LPP:</label>
                                                <div class="col-sm-7 nopad">
                                                    <p>{{list.LPP}}</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-xl-12 nopad">
                                        <div class="col-xl-6 float-left">
                                            <div style="margin-bottom:0;" class="form-group row">
                                                <label style="height:40px;" class="col-sm-6 col-form-label" for="simpleinput">Recommended
                                                    Price: &nbsp;</label>
                                                <div class="col-sm-6 nopad">

                                                    <div class="form-group row">
                                                        <div class="col-sm-10">
                                                            <div class="input-group">
                                                                <div class="input-group-prepend"><span class="input-group-text" id="basic-addon1">{{list.CustomerCurrencySymbol}}</span>
                                                                </div>
                                                                <input class="form-control nopad" id="id_{{list.VQAttachmentId}}" type="text" placeholder="Enter Recommended price" value="{{list.RecomPrice }}" required>

                                                            </div>
                                                        </div>
                                                        <div class="col-sm-2 nopad">
                                                            <em class="mdi mdi-content-save saveicon m-minus-10 cursor-pointer" (click)="updatePrice('id_'+list.VQAttachmentId, list.VQAttachmentId)" ngbTooltip="Save Recommended Price"></em>
                                                        </div>
                                                    </div>


                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-xl-6 float-left">
                                            <div class="form-group row">
                                                <label class="col-sm-5 col-form-label" for="simpleinput">Price Updated
                                                    By:</label>
                                                <div class="col-sm-7 nopad">
                                                    <p>{{list.RecomPriceUpdatedByName != null ? list.RecomPriceUpdatedByName : list.CreatedByName}} on {{list.RecomPriceUpdatedDate != null ? list.RecomPriceUpdatedDate : list.Created}}</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-xl-12 nopad mb-2">
                                        <div class="col-xl-6 float-left">
                                            <div class="form-group row">
                                                <label class="col-sm-6 col-form-label" for="simpleinput">Vendor Cost:</label>
                                                <div class="col-sm-6 nopad">
                                                    <p>{{list.VendorCurrencySymbol}} {{list.VendorCost }}</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-xl-6 float-left">
                                            <div class="form-group row">
                                                <label style="height:40px;" class="col-sm-6 col-form-label" for="simpleinput">Assignee:</label>
                                                <div class="col-sm-6 nopad">
                                                    <div class="form-group row">
                                                        <div class="col-sm-7">
                                                            <div class="input-group">
                                                                <p>{{list.AssigneeUserName != null ? list.AssigneeUserName : '-'}}</p>

                                                            </div>
                                                        </div>
                                                        <div class="col-sm-4 nopad">
                                                            <em class="mdi mdi-account-edit saveicon cursor-pointer" (click)="changeAssignee('id_'+list.VQAttachmentId, list.RRId)" ngbTooltip="Assignee"></em>
                                                        </div>
                                                    </div>


                                                </div>
                                                
                                            </div>
                                        </div>
                                        
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-xl-12 nopad">
                                        <div class="col-xl-12 float-left">
                                            <div class="form-group row">
                                                <label class="col-sm-4 col-form-label mb-2" for="simpleinput">Approver Feedback:</label>
                                                <span><em class="mdi mdi-content-save saveicon cursor-pointer" (click)="updateApproverFeedback('id_AF_'+list.VQAttachmentId, list.VQAttachmentId)" ngbTooltip="Save Approver Feedback"></em></span>
                                                <br><br>
                                                <textarea class="form-control" id="id_AF_{{list.VQAttachmentId}}" [(ngModel)]="list.ApproverFeedback" rows="2" placeholder="Approver Feedback"></textarea>
                                                <!-- <p>{{list.ApproverFeedback || '-'}}</p> -->
                                                
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-xl-12 nopad">
                                        <div class="col-xl-12 float-left">
                                            <div class="form-group row">
                                                <label class="col-sm-3 col-form-label mb-2" for="simpleinput">Internal Notes:</label>
                                                <span><em class="mdi mdi-content-save saveicon cursor-pointer" (click)="updateInternalNotes('id_IN_'+list.VQAttachmentId, list.VQAttachmentId)" ngbTooltip="Save Internal Notes"></em></span>
                                                <br><br>
                                                <textarea class="form-control" id="id_IN_{{list.VQAttachmentId}}" [(ngModel)]="list.InternalNotes" rows="2" placeholder="Internal Notes"></textarea>
                                                <!-- <p>{{list.InternalNotes || '-'}}</p> -->
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                    <!-- RRNo - Bold
                Current Status : Awaiting Vendor Quote
                PON : $346.58
                LPP : $45.25
                Recommended price : $65
                Price Updated By"Admin" on"12/08/2022" -->
                </div>
            </div>
        </div>
    </div>

    <div *ngIf="!loader && Lists.length == 0" style="padding-bottom:1rem !important;" class="card-box quotelistwrap text-center">
        <p>No records found!</p>
    </div>

    <div class="row justify-content-md-between align-items-md-center">
        <div class="col-12 col-xl-6 col-sm-6">
            Showing {{startIndex}} - {{endIndex}} of {{totalRecords}}
        </div>
        <div class="col-12 col-xl-6 col-sm-6">
            <div class="text-md-right float-md-right mt-2">
                <ngb-pagination (pageChange)="onPageChange($event)" [pageSize]="pageSize" [(page)]="page" [collectionSize]="totalRecords" [maxSize]="5" [boundaryLinks]="true">
                </ngb-pagination>
                <!--Pagination-->
            </div>
        </div>
        <!-- end col-->
    </div>

</div>

<div class="container-fluid" *ngIf="!IsViewEnabled">
    <div class="account-pages mt-5 mb-5">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-md-8 col-lg-6 col-xl-5">
                    <div class="card bg-pattern">

                        <div class="card-body p-4">

                            <div class="text-center">
                                <a routerLink="/">
                                    <span><img src="assets/projects/ah-group/full_logo.png" alt=""
                                            height="22"></span>
                                </a>
                            </div>

                            <div class="text-center mt-4">
                                <h1 class="text-error">401</h1>
                                <h3 class="mt-3 mb-2">Access Denied!</h3>
                                <p class="text-muted mb-3">You don't have permission to access this page.</p>

                                <a routerLink="/admin/dashboard/ah-dashboard" class="btn btn-success waves-effect waves-light">Back
                                    to Dashboard</a>
                            </div>

                        </div>
                        <!-- end card-body -->
                    </div>
                    <!-- end card -->

                </div>
                <!-- end col -->
            </div>
            <!-- end row -->
        </div>
        <!-- end container -->
    </div>
</div>
<ngx-spinner #ngxSpinner bdColor="rgba(0, 0, 0, 0.8)" size="medium" color="#fff" type="ball-spin-clockwise" [fullScreen]="true"></ngx-spinner>