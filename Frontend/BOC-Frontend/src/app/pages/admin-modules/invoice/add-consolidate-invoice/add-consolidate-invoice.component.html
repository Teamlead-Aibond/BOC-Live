<!-- 
    /* ===================================================
* @copyright Copyright Â 2020 - 2023 Aibond Corp.
*
* All Rights Reserved.
*
* ========================================================== */
 -->
<div class="container-fluid" *ngIf="IsAddEnabled">
    <div class="row">
        <div class="col-xl-9 float-left">
            <app-page-title title="Consolidate Invoice"></app-page-title>
        </div>
        <div class="col-xl-3 float-right">
            <div class="btn-group btn-group-sm mr-2 mb-2 float-right mt-15" role="group" *ngIf="IsViewEnabled">
                <button class="btn btn-primary waves-effect raa" routerLink="/admin/ConsolidateInvoice-List">
                    Consolidate Invoice List</button>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-12">
                <form class="shipto-vendor" name="form1" #f="ngForm" (ngSubmit)="onSearch(f)" novalidate>
                <div class="card">
                    <div style="padding-bottom:15px;padding-top: 25px;" class="card-body">
                        <div class="row">
                            <div class="col-xl-12 nopad">
                                <div class="col-xl-3 float-left">
                                    <div class="form-group">
                                        <label class="mb-2">Customer Name:
                                            <span class="red">*</span>
                                        </label>
                                        <ng-select [items]="customers$ | async" [typeahead]="customersInput$"
                                            [loading]="loadingCustomers" [multiple]="false" [closeOnSelect]="true"
                                            (change)="getBlanketList()" [searchable]="true" [virtualScroll]="true"
                                            placeholder="Select" name="CustomerId" bindLabel="CustomerCode"
                                            bindValue="CustomerId" [(ngModel)]="model.CustomerId" #CustomerId="ngModel"
                                                    [ngClass]="{ 'is-invalid': f.submitted && CustomerId.invalid }"
                                                    required>
                                        </ng-select>
                                        <div *ngIf="f.submitted &&CustomerId.invalid" class="invalid-feedback">
                                            <div *ngIf="CustomerId.errors.required">Customer is required</div>
                                        </div>


                                    </div>
                                    <div class="form-group">
                                        <label class="control-label">Status</label>
                                        <select class="custom-select" [(ngModel)]="model.Status" name="Status">
                                            <option value="">Select</option>
                                            <option *ngFor="let Cust_invoice_status of Customer_Invoice_Status"
                                                value="{{Cust_invoice_status.Cust_Invoice_StatusId}}">
                                                {{Cust_invoice_status.Cust_Invoice_StatusName}}</option>
                                        </select>
                                    </div>




                                </div>

                                <div class="col-xl-6 float-left">
                                    <div class="form-group">
                                        <label class="mb-2">Invoice Numbers(Add Multiple Invoices separated by
                                            comma):</label>
                                        <textarea style="height:90px;" #textarea class="form-control" rows="3"
                                            [(ngModel)]="model.InvoiceNo" name="InvoiceNo"></textarea>
                                    </div>
                                </div>
                                <div class="col-xl-3 float-left">
                                    <div style="margin-bottom: 5px;" class="form-group">
                                        <label>Customer PO Type:</label>
                                        <div style="margin-top:10px;" class="row rc">
                                            <div class="col-xl-6 nopad">

                                                <label style="font-weight: 400 !important;"><input
                                                        style="margin-left:10px;" type="radio" name="Type1" value="1"
                                                        [disabled]="(this.model.CustomerId != '' && this.model.CustomerId != null && this.model.CustomerId != undefined)?false:true"
                                                        #Type="ngModel" (change)="setBlanketCutomer(model.Type)"
                                                        [(ngModel)]="model.Type" />
                                                    Blanket PO

                                                </label>
                                            </div>
                                            <div class="col-xl-6">

                                                <label style="font-weight: 400 !important;"><input
                                                        style="margin-left:10px;" type="radio" name="Type2" value="0"
                                                        #Type="ngModel" (change)="setCustomerPO(model.Type)"
                                                        [(ngModel)]="model.Type" />
                                                    Custom PO
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-xl-12 col-md-12"
                                            *ngIf="BlanketPO && (this.model.CustomerId != '' && this.model.CustomerId != null && this.model.CustomerId != undefined)">

                                            <div class="form-group">
                                                <label class="mb-2" for="Customer">Select Blanket PO #:

                                                </label>
                                                <ng-select [items]="BlanketddlList" name="CustomerBlanketPOId"
                                                    placeholder="Select" [(ngModel)]="model.CustomerBlanketPOId"
                                                    #CustomerBlanketPOId="ngModel" bindLabel="title"
                                                    bindValue="CustomerBlanketPOId" [searchable]="true">

                                                </ng-select>

                                            </div>
                                        </div>
                                        <div class="col-xl-12 col-md-12" *ngIf="CustomPO">
                                            <div class="form-group">
                                                <label class="mb-2" for="Customer">Enter Custom PO #

                                                </label>

                                                <input type="text" class="form-control" id="CustomerPONo"
                                                    placeholder="Customer PO  #" [(ngModel)]="model.CustomerPONo"
                                                    name="CustomerPONo" #CustomerPONo="ngModel">



                                            </div>
                                        </div>


                                    </div>
                                </div>


                            </div>
                        </div>

                        <div class="row">
                            <div style="margin-bottom: 15px;" class="col-xl-12 text-center nopad">
                                <button class="btn btn-primary btn-md mr-1" value="Search">Search</button>
                                <input type="button" class="btn btn-secondary btn-md" value="Clear"
                                    (click)="onClear()" />
                                <!-- <button  type="button" class="btn btn-pink btn-md ml-1" (click)="isAllSelected()" *ngIf="!selectalldisable">Select All</button>
                                <button  type="button" class="btn btn-pink btn-md ml-1" (click)="isAllUnSelected()" *ngIf="selectalldisable">UnSelect All</button> -->

                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <div class="row" style="display: none!important;" id="datatable-list">
        <div class="col-12">
            <div class="card-box">
                <div class="row">
                    <div class="col-xl-12">
                        <div tyle="padding-right: 15px;" class="table-responsive">
                            <table id="datatable-invoicelist" datatable [dtOptions]="dtOptions" [dtTrigger]="dtTrigger"
                                class="table datatables dt-responsive hover nowrap">
                                <thead class="thead-light">
                                    <tr>
                                    <tr>
                                        <th>
                                            <div class="form-check">
                                                <label class="form-check-label" style="margin-bottom: 15px;">
                                                    <input class="form-check-input" type="checkbox"
                                                        [checked]="gridCheckAll"
                                                        (change)="gridAllRowsCheckBoxChecked($event)" />
                                                    <span class="form-check-sign">
                                                        <span class="check"></span>
                                                    </span>
                                                </label>
                                            </div>
                                        </th>
                                        <th>Invoice No</th>
                                        <th>MRO / RR No</th>
                                        <th>Customer Name</th>
                                        <th>Invoice Type</th>
                                        <th>Grand Total</th>
                                        <th>Invoice Date</th>
                                        <th>Status</th>
                                        <th>CustomerPO No</th>
                                    </tr>
                                </thead>
                                <tbody *ngIf="InvoiceList?.length != 0">
                                    <tr *ngFor="let item of InvoiceList; let i=index">
                                        <td><input type="checkbox" class="checkbox" [checked]="item.checked"
                                                (change)="rowCheckBoxChecked($event,item.InvoiceNo, item.InvoiceId,item.CustomerId,item.CustomerPONo,item.CustomerBlanketPOId,item.LocalCurrencyCode)"
                                                [disabled]="item.IsApproved==1 && item.Consolidated!=1?false:true">
                                        </td>
                                        <td><a [routerLink]="(['/admin/invoice/list'])"
                                                [queryParams]="{ InvoiceId: item.InvoiceId}" class="actionView1"
                                                target="_blank" data-toggle='tooltip' ngbTooltip='Invoice View'
                                                data-placement='top'>{{item.InvoiceNo}}
                                               <span *ngIf="item.Consolidated==1"><i class="fas fa-check-circle greentick" ngbTooltip='Exist in Consolidate Invoice' placement="right"></i></span> 
                                            </a>
                                        </td>
                                        <td>
                                            <a *ngIf="item.RRNo != '' && item.RRNo != '0' && item.RRNo != null"
                                                [routerLink]="(['/admin/repair-request/edit'])" target="_blank"
                                                [queryParams]="{ RRId: item.RRId}" data-toggle='tooltip'
                                                ngbTooltip='RR View' data-placement='top'>{{item.RRNo}}</a>
                                            <a *ngIf="item.MRONo != '' && item.MRONo != '0' && item.MRONo != null"
                                                target="_blank" [routerLink]="(['/admin/mro/edit'])"
                                                [queryParams]="{ MROId: item.MROId}" data-toggle='tooltip'
                                                ngbTooltip='RR View' data-placement='top'>{{item.MRONo}}</a>
                                            <a *ngIf="(item.RRNo == '' || item.RRNo == '0' || item.RRNo == null) &&(item.MRONo == '' || item.MRONo == '0' || item.MRONo == null)&& item.QuoteNo != '' && item.QuoteNo != '0' && item.QuoteNo != null"
                                                target="_blank" [routerLink]="(['/admin/sales-quote/list'])"
                                                [queryParams]="{ QuoteId: item.QuoteId}" data-toggle='tooltip'
                                                ngbTooltip='Quote View' data-placement='top'>{{item.QuoteNo}}</a>

                                        </td>
                                        <td>
                                            {{item.CompanyName}}
                                        </td>
                                        <td>

                                            <div [ngClass]="GetClassInvoiceTypeName(item.InvoiceType)">
                                                {{InvoiceType}}
                                            </div>
                                        </td>
                                        <td>
                                            {{item.GrandTotal}}
                                        </td>
                                        <td>
                                            {{item.InvoiceDate}}
                                        </td>
                                        <td>
                                            <div [ngClass]="GetClassStatusName(item.Status)">
                                                {{StatusName}}
                                            </div>
                                        </td>
                                        <td>
                                            <a *ngIf="item.CustomerBlanketPOId != '' && item.CustomerBlanketPOId != '0' && item.CustomerBlanketPOId != null"
                                                [routerLink]="(['/admin/Blanket-PO-History'])"
                                                [queryParams]="{ CustomerBlanketPOId: item.CustomerBlanketPOId}"
                                                target="_blank" data-toggle='tooltip' ngbTooltip='Blanket PO History'
                                                data-placement='top'>{{item.CustomerPONo}}</a>
                                            <p
                                                *ngIf="item.CustomerBlanketPOId == '' || item.CustomerBlanketPOId == '0' || item.CustomerBlanketPOId == null">
                                                {{item.CustomerPONo}}
                                            <p>

                                        </td>


                                    </tr>
                                </tbody>
                                <tbody *ngIf="InvoiceList?.length == 0">
                                    <tr>
                                        <td colspan="10" class="no-data-available">{{dataTableMessage}}</td>
                                    </tr>
                                <tbody>
                            </table>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
    <div class="row" style="display: none!important;" id="datatable-list2">
        <div class="col-12">
            <div class="card-box">
                <div class="row">
                    <div class="col-xl-12">
                        <div tyle="padding-right: 15px;" class="table-responsive">
                            <table id="datatable-invoicelist2" datatable [dtOptions]="dtOptions2"
                                [dtTrigger]="dtTrigger2" class="table datatables dt-responsive hover nowrap">
                                <thead class="thead-light">
                                    <tr>
                                    <tr>
                                        <th>
                                            <div class="form-check">
                                                <label class="form-check-label" style="margin-bottom: 15px;">
                                                    <input class="form-check-input" type="checkbox"
                                                        [checked]="gridCheckAll"
                                                        (change)="gridAllRowsCheckBoxChecked($event)" />
                                                    <span class="form-check-sign">
                                                        <span class="check"></span>
                                                    </span>
                                                </label>
                                            </div>
                                        </th>
                                        <th>Invoice No</th>
                                        <th>MRO / RR No</th>
                                        <th>Customer Name</th>
                                        <th>Invoice Type</th>
                                        <th>Grand Total</th>
                                        <th>Invoice Date</th>
                                        <th>Status</th>
                                        <th>CustomerPO No</th>
                                    </tr>
                                </thead>
                                <tbody *ngIf="InvoiceList?.length != 0">
                                    <tr *ngFor="let item of InvoiceList; let i=index">
                                        <td><input type="checkbox" class="checkbox" [checked]="item.checked"
                                                (change)="rowCheckBoxChecked($event,item.InvoiceNo, item.InvoiceId,item.CustomerId,item.CustomerPONo,item.CustomerBlanketPOId,item.LocalCurrencyCode)"
                                                [disabled]="item.IsApproved==1 && item.Consolidated!=1?false:true">
                                        </td>
                                        <td><a [routerLink]="(['/admin/invoice/list'])"
                                                [queryParams]="{ InvoiceId: item.InvoiceId}" class="actionView1"
                                                target="_blank" data-toggle='tooltip' ngbTooltip='Invoice View'
                                                data-placement='top'>{{item.InvoiceNo}}
                                                <span *ngIf="item.Consolidated==1"><i class="fas fa-check-circle greentick" ngbTooltip='Exist in Consolidate Invoice' placement="right"></i></span></a>
                                        </td>
                                        <td>
                                            <a *ngIf="item.RRNo != '' && item.RRNo != '0' && item.RRNo != null"
                                                [routerLink]="(['/admin/repair-request/edit'])" target="_blank"
                                                [queryParams]="{ RRId: item.RRId}" data-toggle='tooltip'
                                                ngbTooltip='RR View' data-placement='top'>{{item.RRNo}}</a>
                                            <a *ngIf="item.MRONo != '' && item.MRONo != '0' && item.MRONo != null"
                                                [routerLink]="(['/admin/mro/edit'])" target="_blank"
                                                [queryParams]="{ MROId: item.MROId}" data-toggle='tooltip'
                                                ngbTooltip='RR View' data-placement='top'>{{item.MRONo}}</a>
                                            <a *ngIf="(item.RRNo == '' || item.RRNo == '0' || item.RRNo == null) &&(item.MRONo == '' || item.MRONo == '0' || item.MRONo == null)&& item.QuoteNo != '' && item.QuoteNo != '0' && item.QuoteNo != null"
                                                target="_blank" [routerLink]="(['/admin/sales-quote/list'])"
                                                [queryParams]="{ QuoteId: item.QuoteId}" data-toggle='tooltip'
                                                ngbTooltip='Quote View' data-placement='top'>{{item.QuoteNo}}</a>

                                        </td>
                                        <td>
                                            {{item.CompanyName}}
                                        </td>
                                        <td>

                                            <div [ngClass]="GetClassInvoiceTypeName(item.InvoiceType)">
                                                {{InvoiceType}}
                                            </div>
                                        </td>
                                        <td>
                                            {{item.GrandTotal}}
                                        </td>
                                        <td>
                                            {{item.InvoiceDate}}
                                        </td>
                                        <td>
                                            <div [ngClass]="GetClassStatusName(item.Status)">
                                                {{StatusName}}
                                            </div>
                                        </td>
                                        <td>
                                            <a *ngIf="item.CustomerBlanketPOId != '' && item.CustomerBlanketPOId != '0' && item.CustomerBlanketPOId != null"
                                                [routerLink]="(['/admin/Blanket-PO-History'])"
                                                [queryParams]="{ CustomerBlanketPOId: item.CustomerBlanketPOId}"
                                                target="_blank" data-toggle='tooltip' ngbTooltip='Blanket PO History'
                                                data-placement='top'>{{item.CustomerPONo}}</a>
                                            <p
                                                *ngIf="item.CustomerBlanketPOId == '' || item.CustomerBlanketPOId == '0' || item.CustomerBlanketPOId == null">
                                                {{item.CustomerPONo}}
                                            <p>
                                        </td>


                                    </tr>
                                </tbody>
                                <tbody *ngIf="InvoiceList?.length == 0">
                                    <tr>
                                        <td colspan="10" class="no-data-available">{{dataTableMessage}}</td>
                                    </tr>
                                <tbody>
                            </table>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
    <div class="row" *ngIf="InvoiceList.length>0">
        <div class="col-12">
            <div class="sticky-container">
                <div id="so-groups" class="right so-groups-sticky hidden-xs" style="top:198px">

                    <button class="btn-group btn-group-sm float-right" (click)="onSubmit()">
                        <span>Submit</span> <i class="mdi mdi-content-save"></i>
                    </button>

                </div>
            </div>
        </div>
    </div>




</div>
<div class="account-pages mt-5 mb-5" *ngIf="!IsAddEnabled">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-8 col-lg-6 col-xl-5">
                <div class="card bg-pattern">

                    <div class="card-body p-4">

                        <div class="text-center">
                            <a routerLink="/">
                                <span><img src="assets/projects/ah-group/full_logo.png" alt="" height="22"></span>
                            </a>
                        </div>

                        <div class="text-center mt-4">
                            <h1 class="text-error">401</h1>
                            <h3 class="mt-3 mb-2">Access Denied!</h3>
                            <p class="text-muted mb-3">You don't have permission to access this page.</p>

                            <a routerLink="/admin/dashboard/ah-dashboard"
                                class="btn btn-success waves-effect waves-light">Back
                                to Dashboard</a>
                        </div>

                    </div>
                    <!-- end card-body -->
                </div>
                <!-- end card -->

            </div>
            <!-- end col -->
        </div>
        <!-- end row -->
    </div>
    <!-- end container -->
</div>