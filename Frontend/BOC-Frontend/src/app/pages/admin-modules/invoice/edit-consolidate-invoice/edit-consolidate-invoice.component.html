<!-- 
    /* ===================================================
* @copyright Copyright  2020 - 2023 Aibond Corp.
*
* All Rights Reserved.
*
* ========================================================== */
 -->
<div class="container-fluid" *ngIf="IsEditEnabled">
    <div class="row">
        <div class="col-xl-9">
            <app-page-title title="Consolidate Invoice Edit"> </app-page-title>
        </div>
        <div class="col-xl-3">
            <a class="gridview-ico" (click)="BackToView()" ngbTooltip="Grid List" *ngIf="IsViewEnabled">
                <img src="../../../../assets/images/icons/Grid.png">
            </a>
        </div>
    </div>
    <!-- <app-page-title title="Edit Invoice"></app-page-title> -->
    <!-- <form name="form" #f="ngForm" (ngSubmit)="onSubmit(f)" novalidate>
        <div class="row">
            <div class="col-12">
                <div class="sticky-container">
                    <div id="so-groups" class="right so-groups-sticky hidden-xs" style="top:198px">
                   
                          
                        
                          
                        <button [disabled]="btnDisabled"  [ngClass]="{'class': (btnDisabled)? 'gray': 'btn-group btn-group-sm float-right'}"><span>Save</span>
                            <i class="mdi mdi-content-save "></i></button>

                     
                       
                            <button type="button" class="bg-danger" (click)="BackToView()"><span
                                class="bg-danger">Back</span>
                            <i class="fas fa-arrow-left"></i></button> 

                    </div>
                </div>
            </div>
        </div> -->
    <div class="row">

        <div class="col-12">
            <div class="card-box">

                <div style="margin-top: 0;" class="row mb20">

                    <div class="col-sm-4 col-xl-4">
                        <div class="clearfix">
                            <div class="float-left">
                                <img class="img-responsive" src="assets/images/ah_logo.png" alt="" height="35">
                            </div>

                        </div>
                        <div class="mt-3">
                            <h5>REMIT TO :</h5>
                            <h5 style="margin-top:-11px;">
                                {{REMIT_Address.EntityAddress1}},
                                <span
                                    *ngIf="REMIT_Address.EntityAddress2 != ''">{{REMIT_Address.EntityAddress2}},</span>
                                <br>
                                {{REMIT_Address.EntityCity}}, {{REMIT_Address.EntityState}}
                                {{REMIT_Address.EntityZip}}<br>
                                {{REMIT_Address.EntityPhone1}}<br>
                                VAT No : {{REMIT_Address.EntityVATNo || '-'}}<br>
                                <span *ngIf="REMIT_Address.EntityEmail != ''"> {{REMIT_Address.EntityEmail}}<br></span>
                                <span *ngIf="REMIT_Address.EntityWebsite != ''">
                                    <a href="{{REMIT_Address.EntityWebsite}}"
                                        target="_blank">{{REMIT_Address.EntityWebsite}}</a><br></span>
                            </h5>


                        </div>
                        <div class="mt-3">

                        </div>

                    </div>

                    <!-- <div class="col-md-4 col-xl-4 invoicepara">
                            <table class="table mt-2 table-bordered mb-0 inv-table print-table">
                                <thead class="thead-light">
                                    <tr>
                                        <th colspan="2">Invoice Info</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>
                                            <p><b>Invoice Requested Date :</b> {{InvoiceInfo.InvoiceDate|dateTransform}}</p>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <p><b>Invoice Due Date :</b> {{InvoiceInfo.DueDate|dateTransform}}</p>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td *ngIf="InvoiceInfo.Status==2">
                                            <p><b>Approved Date :</b> {{InvoiceInfo.ApprovedDate|dateTransform}}</p>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <p><b>Terms :</b> {{InvoiceInfo.TermsName || '-'}}</p>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <p><b>Invoice # :</b> {{InvoiceInfo.InvoiceNo || '-'}}</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
            
                        </div> -->

                    <div class="col-sm-4 col-xl-4">
                        <div class="mt-6 row">

                            <div class="col-xl-5 col-md-5 ccs">
                                <p class="m-b-10 text-left"><strong>Customer : </strong></p>
                            </div>
                            <div class="col-xl-7 col-md-7">
                                <p class="m-b-10"><span class="customerbg">{{InvoiceInfo.CompanyName}}</span>
                                </p>
                            </div>
                        </div>

                        <div class="mt-6 row">

                            <div class="col-xl-5 col-md-5 ccs">
                                <p class="m-b-10 text-left"><strong>Created Date: </strong></p>
                            </div>
                            <div class="col-xl-7 col-md-7">
                                <p class="m-b-10"><span class="customerbg1">{{InvoiceInfo.Created |
                                        date:'shortDate'}}</span>
                                </p>
                            </div>
                        </div>

                        <div class="mt-6 row">
                            <div class="col-xl-5 col-md-5 ccs">
                                <p class="m-b-10 text-left"><strong>Created By : </strong></p>
                            </div>
                            <div class="col-xl-7 col-md-7">
                                <p class="m-b-10"><span
                                        class="badge badge-success btn-xs poibtn">{{InvoiceInfo.CreatedByName}}</span>
                                </p>
                            </div>
                        </div>
                        <div class="mt-6 row">
                            <div class="col-xl-5 col-md-5 ccs">
                                <p class="m-b-10 text-left"><strong>Customer PO # : </strong></p>
                            </div>
                            <div class="col-xl-7 col-md-7">
                                <p class="m-b-10">
                                    <span class="badge badge-pink btn-xs poibtn">
                                        <a *ngIf="InvoiceInfo.CustomerBlanketPOId != '' && InvoiceInfo.CustomerBlanketPOId != '0' && InvoiceInfo.CustomerBlanketPOId != null"
                                            target="_blank" [routerLink]="(['/admin/Blanket-PO-History'])"
                                            [queryParams]="{ CustomerBlanketPOId: InvoiceInfo.CustomerBlanketPOId}"
                                            data-toggle='tooltip' ngbTooltip='Blanket PO History'
                                            data-placement='top'>{{InvoiceInfo.CustomerPONo}}</a>

                                    </span>
                                    <span class="badge badge-pink btn-xs poibtn"
                                        *ngIf="InvoiceInfo.CustomerBlanketPOId == '' || InvoiceInfo.CustomerBlanketPOId == '0' || InvoiceInfo.CustomerBlanketPOId == null">{{InvoiceInfo.CustomerPONo}}</span>

                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-4 col-lg-4">
                        <div class="">
                            <table class="table mt-2 table-bordered mb-0 print-table">
                                <thead class="thead-light">
                                    <tr>
                                        <th colspan="2"><b style="font-weight: bold;">Billing Address</b></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>
                                            {{InvoiceInfo.CompanyName}}<br> {{BillingAddress.StreetAddress}} {{BillingAddress.SuiteOrApt}},
                                            {{BillingAddress.City}}
                                            <br> {{BillingAddress.StateName}}, {{BillingAddress.CountryName}} -
                                            {{BillingAddress.Zip}}
                                            <div class="clear1">&nbsp;</div>
                                            <span><i class="mdi mdi-phone mr-1" ngbTooltip="Primary"
                                                    *ngIf="PhoneBillingAddress!=null"></i>
                                                {{BillingAddress.Phone}}</span>
                                            <div class="clear1">&nbsp;</div>
                                            <span><i class="mdi mdi-fax mr-1" *ngIf="faxBillingAddress!=''"></i>
                                                {{BillingAddress.Fax}}</span>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>


                    <!-- end col -->
                </div>
                <div class="row mt-2">
                    <div class="col-12">
                        <h5 style="margin-top: 0;">Consolidate Invoice Details
                            <button (click)="addItem(AddItem)" type="button" class="btn btn-add waves-effect">
                                <i class="remixicon-add-fill mt-3"></i> Add
                            </button>
                        </h5>



                        <div class="table-responsive mt-1">
                            <table class="table table-bordered idt mb-0">
                                <thead class="thead-light">
                                    <tr>
                                    <tr>

                                        <th>Invoice No</th>
                                        <th>MRO / RR No</th>
                                        <th>Invoice Type</th>
                                        <th>Grand Total</th>
                                        <th>Invoice Date</th>
                                        <th>Status</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody *ngIf="InvoiceItem?.length != 0">
                                    <tr *ngFor="let item of InvoiceItem; let i=index">

                                        <td><a [routerLink]="(['/admin/invoice/list'])"
                                                [queryParams]="{ InvoiceId: item.InvoiceId}" class="actionView1"
                                                target="_blank" data-toggle='tooltip' ngbTooltip='Invoice View'
                                                data-placement='top'>{{item.InvoiceNo}}</a>
                                        </td>
                                        <td>
                                            <a *ngIf="item.RRNo != '' && item.RRNo != '0' && item.RRNo != null"
                                                [routerLink]="(['/admin/repair-request/edit'])" target="_blank"
                                                [queryParams]="{ RRId: item.RRId}" data-toggle='tooltip'
                                                ngbTooltip='RR View' data-placement='top'>{{item.RRNo}}</a>
                                            <a *ngIf="item.MRONo != '' && item.MRONo != '0' && item.MRONo != null"
                                                target="_blank" [routerLink]="(['/admin/mro/edit'])"
                                                [queryParams]="{ MROId: item.MROId}" data-toggle='tooltip'
                                                ngbTooltip='RR View' data-placement='top'>{{item.MRONo}}</a>
                                            <a *ngIf="(item.RRNo == '' || item.RRNo == '0' || item.RRNo == null) &&(item.MRONo == '' || item.MRONo == '0' || item.MRONo == null)&& item.QuoteNo != '' && item.QuoteNo != '0' && item.QuoteNo != null"
                                                target="_blank" [routerLink]="(['/admin/sales-quote/list'])"
                                                [queryParams]="{ QuoteId: item.QuoteId}" data-toggle='tooltip'
                                                ngbTooltip='Quote View' data-placement='top'>{{item.QuoteNo}}</a>

                                        </td>

                                        <td>

                                            <div [ngClass]="GetClassInvoiceTypeName(item.InvoiceType)">
                                                {{item.InvoiceTypeName}}
                                            </div>
                                        </td>
                                        <td>
                                            {{item.LocalCurrencySymbol}} {{item.GrandTotal}}
                                        </td>
                                        <td>
                                            {{item.InvoiceDate|date:'shortDate'}}
                                        </td>
                                        <td>
                                            <div [ngClass]="GetClassStatusName(item.Status)">
                                                {{item.StatusName}}
                                            </div>
                                        </td>

                                        <td>
                                            <a style="cursor: pointer;"
                                                (click)="onDelete(item.ConsolidateInvoiceDetailId)"
                                                class="fa fa-trash text-danger actionView3" data-toggle='tooltip'
                                                title='Consolidate Invoice  Line item Delete' data-placement='top'></a>
                                        </td>
                                    </tr>
                                </tbody>
                                <tbody *ngIf="InvoiceItem?.length == 0">
                                    <tr>
                                        <td colspan="10" class="no-data-available">No Data!</td>
                                    </tr>
                                <tbody>
                            </table>

                        </div>


                    </div>
                    <!-- end col -->
                </div>
                <div class="row mt-2">
                    <!-- end col -->
                    <div class="col-sm-12">
                        <div class="text-right">
                            <div class="table-responsive">
                                <table class="table table-borderless bill mb-0">
                                    <tbody>


                                        <tr class="grandouter">
                                            <th width="90%" align="right" scope="row">
                                                <p class="grandtotal"><b>Grand Total :</b></p>

                                            </th>
                                            <td>
                                                <p><b>{{GrandTotal}}</b></p>
                                            </td>

                                        </tr>




                                        <tr *ngIf="IsDisplayBaseCurrencyValue==1">
                                            <th width="90%" scope="row">
                                                <p><b>Grand Total ({{BaseCurrencySymbol}}) :</b></p>
                                            </th>
                                            <td>
                                                <p><b>{{GrandTotalUSD}} </b></p>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>






                        </div>
                        <div class="clearfix"></div>
                    </div>
                    <!-- end col -->
                </div>

            </div>
            <!-- end card-box -->
        </div>

        <!-- end col -->
    </div>
    <!-- </form> -->
    <!-- end row -->
</div>

<ng-template #AddItem let-modal="close">
    <div class="modal-header">
        <h4 class="modal-title">Add Invoice Item</h4>
        <button type="button" class="close" (click)="modal('Cross click')" aria-hidden="true">×</button>
    </div>
    <div class="modal-body p-4">
        <form name="form" #f="ngForm" (ngSubmit)="(f.form.valid) ? onItemSubmit() : false" novalidate>

            <div class="row">
                <div class="form-group">
                    <label for="Customer">Enter Invoice # <span class="red">*</span></label>
                    <div class="row col-xl-12">

                        <div style="padding: 0;" class="col-xl-6">
                            <input id="PartNo" [(ngModel)]="model.InvoiceNo" name="InvoiceNo" type="text"
                                class="form-control" #InvoiceNo="ngModel"
                                [ngClass]="{ 'is-invalid': f.submitted && InvoiceNo.invalid }" required>
                            <div *ngIf="f.submitted &&InvoiceNo.invalid" class="invalid-feedback">
                                <div *ngIf="InvoiceNo.errors.required">Invoice No is required</div>
                            </div>
                        </div>
                        <div class="col-xl-6">

                            <button type="button" class="btn btn-success waves-effect waves-light"
                                (click)="onSearch()">Search</button>
                        </div>

                    </div>
                </div>
            </div>

            <div class="row" *ngIf="ShowAddList">
                <div class="table-responsive mt-15">
                    <table class="table table-bordered idt mb-0">
                        <thead class="thead-light">
                            <tr>
                            <tr>
                                <th>
                                    <div class="form-check">
                                        <label class="form-check-label" style="margin-bottom: 15px;">
                                            <input class="form-check-input" type="checkbox" [checked]="gridCheckAll"
                                                (change)="gridAllRowsCheckBoxChecked($event)" />
                                            <span class="form-check-sign">
                                                <span class="check"></span>
                                            </span>
                                        </label>
                                    </div>
                                </th>
                                <th>Invoice No</th>
                                <th>MRO / RR No</th>
                                <th>Invoice Type</th>
                                <th>Grand Total</th>
                                <th>Invoice Date</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody *ngIf="InvoiceList?.length != 0">
                            <tr *ngFor="let item of InvoiceList; let i=index">
                                <td><input type="checkbox" class="checkbox" [checked]="item.checked"
                                        (change)="rowCheckBoxChecked($event,item.InvoiceNo, item.InvoiceId,item.CustomerId,item.CustomerPONo,item.CustomerBlanketPOId,item.LocalCurrencyCode)"
                                        target="_blank"
                                        [disabled]="item.IsApproved==1 && item.Consolidated!=1?false:true">
                                </td>
                                <td><a [routerLink]="(['/admin/invoice/list'])"
                                        [queryParams]="{ InvoiceId: item.InvoiceId}" class="actionView1"
                                        data-toggle='tooltip' ngbTooltip='Invoice View' target="_blank"
                                        data-placement='top'>{{item.InvoiceNo}}</a>
                                </td>
                                <td>
                                    <a *ngIf="item.RRNo != '' && item.RRNo != '0' && item.RRNo != null"
                                        [routerLink]="(['/admin/repair-request/edit'])"
                                        [queryParams]="{ RRId: item.RRId}" data-toggle='tooltip' ngbTooltip='RR View'
                                        target="_blank" data-placement='top'>{{item.RRNo}}</a>
                                    <a *ngIf="item.MRONo != '' && item.MRONo != '0' && item.MRONo != null"
                                        [routerLink]="(['/admin/mro/edit'])" [queryParams]="{ MROId: item.MROId}"
                                        target="_blank" data-toggle='tooltip' ngbTooltip='RR View'
                                        data-placement='top'>{{item.MRONo}}</a>
                                    <a *ngIf="(item.RRNo == '' || item.RRNo == '0' || item.RRNo == null) &&(item.MRONo == '' || item.MRONo == '0' || item.MRONo == null)&& item.QuoteNo != '' && item.QuoteNo != '0' && item.QuoteNo != null"
                                        [routerLink]="(['/admin/sales-quote/list'])" target="_blank"
                                        [queryParams]="{ QuoteId: item.QuoteId}" data-toggle='tooltip'
                                        ngbTooltip='Quote View' data-placement='top'>{{item.QuoteNo}}</a>

                                </td>

                                <td>

                                    <div [ngClass]="GetClassInvoiceTypeName(item.InvoiceType)">
                                        {{InvoiceType}}
                                    </div>
                                </td>
                                <td>
                                    {{item.GrandTotal}}
                                </td>
                                <td>
                                    {{item.InvoiceDate}}
                                </td>
                                <td>
                                    <div [ngClass]="GetClassStatusName(item.Status)">
                                        {{StatusName}}
                                    </div>
                                </td>



                            </tr>
                        </tbody>
                        <tbody *ngIf="InvoiceList?.length == 0">
                            <tr>
                                <td colspan="10" class="no-data-available">No Data!</td>
                            </tr>
                        <tbody>
                    </table>

                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-secondary waves-effect"
                    (click)="modal('Cross click')">Close</button>
                <button class="btn btn-success waves-effect waves-light">Add</button>
            </div>
        </form>
    </div>

</ng-template>
<div class="account-pages mt-5 mb-5" *ngIf="!IsEditEnabled">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-8 col-lg-6 col-xl-5">
                <div class="card bg-pattern">

                    <div class="card-body p-4">

                        <div class="text-center">
                            <a routerLink="/">
                                <span><img src="assets/projects/ah-group/full_logo.png" alt="" height="22"></span>
                            </a>
                        </div>

                        <div class="text-center mt-4">
                            <h1 class="text-error">401</h1>
                            <h3 class="mt-3 mb-2">Access Denied!</h3>
                            <p class="text-muted mb-3">You don't have permission to access this page.</p>

                            <a routerLink="/admin/dashboard/ah-dashboard"
                                class="btn btn-success waves-effect waves-light">Back
                                to Dashboard</a>
                        </div>

                    </div>
                    <!-- end card-body -->
                </div>
                <!-- end card -->

            </div>
            <!-- end col -->
        </div>
        <!-- end row -->
    </div>
    <!-- end container -->
</div>